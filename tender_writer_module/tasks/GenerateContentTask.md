# Task: GenerateContentTask

## Description

This is the core content generation engine of the `TenderWriter` module. It takes the structured outline and populates each subsection with detailed, high-quality text, including placeholders for images.

## Inputs

-   `outline.json`: The structured outline file generated by `GenerateOutlineTask`. Located in the `/output` directory.

## Process

1.  **Parse Outline:** The `TenderWritingAgent` reads and parses `outline.json` to extract a flat list of all subsections. Each subsection is treated as an individual job.

2.  **Setup Concurrent Queue:** The agent initializes a concurrent processing queue with the following parameters:
    -   **Max Concurrency:** 15 (Semaphore to limit active LLM calls).
    -   **Batch Size:** 15 jobs are queued at a time.
    -   **Batch Delay:** A 200ms delay is enforced between the processing of each batch to manage load.

3.  **Process Jobs:** For each subsection job in the queue:
    -   **Construct Prompt:** The agent creates a specific prompt for the LLM. This prompt includes:
        -   The full context of the subsection's position in the document (e.g., "You are writing Chapter 2, Section 1, Subsection 1: '...'.")
        -   The `content_summary` for that subsection from `outline.json`.
        -   The full content of the original `tech.md` and `score.md` for context.
        -   A requirement for the output to be substantial (>= 5000 characters).
        -   The critical instruction to intelligently insert `[!IMAGE]` placeholders where diagrams are needed.
    -   **Invoke LLM:** The agent calls the LLM.
    -   **Save Output:** The returned Markdown text is saved to a corresponding file within the `/output/content/` directory, mirroring the chapter/section structure.

4.  **Assemble Final Document:** After all jobs in the queue are completed:
    -   The agent reads all the individual `.md` files from the `/output/content/` directory in the correct order as defined by `outline.json`.
    -   It concatenates them to create the final `content.md` file.

## Outputs

-   **Structured Content:** A directory structure inside `/output/content/` containing individual Markdown files for each generated section/subsection.
-   **Consolidated Document:** A single `content.md` file in the `/output/` directory, containing the full, assembled text.
