# 软件项目评估系统 - 产品需求文档 (PRD)

## 1. 产品概述

### 1.1 产品定位
软件项目评估系统（PPA - Project Portfolio Assessment）是一个Web应用，用于替代传统Excel表格，实现软件项目成本和风险评估的系统化、在线化管理。

### 1.2 目标用户
个人使用，用于项目成本评估和报价管理。

### 1.3 核心价值
- **标准化**：统一评估流程和计算模型
- **高效率**：模板复用，减少重复工作
- **可追溯**：历史数据保存，便于分析和审计
- **灵活性**：参数可配置，适应不同项目类型

## 2. 功能模块详细说明

### 2.1 数据看板 (Dashboard)

#### 2.1.1 功能描述
提供项目评估数据的可视化展示，帮助快速了解项目整体情况。

#### 2.1.2 功能要素
- **统计卡片**
  - 评估项目总数：显示系统中所有已完成评估的项目数量
  - 项目平均成本：计算所有项目的平均总成本（单位：万元）
  
- **风险等级分布图**
  - 图表类型：饼图
  - 数据维度：低风险（<50分）、中风险（50-100分）、高风险（>100分）
  - 显示内容：各风险等级项目数量及占比

#### 2.1.3 数据来源
- 实时从 `/api/projects` 接口获取项目数据
- 自动计算统计指标

### 2.2 项目评估模块

#### 2.2.1 新建评估 (`/assessment/new`)

##### 功能描述
通过分步向导的方式，引导用户完成项目的成本和风险评估。

##### 业务流程
```
选择模板(可选) → 风险评分 → 工作量估算 → 其他成本 → 生成总览 → 保存项目
```

##### 详细功能点

**步骤一：风险评分**
- **功能**：根据预设的风险评估项，对项目进行风险打分
- **交互**：
  - 每个风险项显示为下拉选择框
  - 选项包含描述和对应分值
  - 实时计算并显示风险总分和评分因子
- **计算逻辑**：
  - 风险总分 = 所有评估项分值之和
  - 评分因子 = 风险总分 / 100

**步骤二：工作量估算**
- **功能**：分别估算新功能开发和系统对接的工作量
- **子模块**：
  1. **新功能开发**
     - 支持添加多个功能模块
     - 每个模块需填写：一级/二级/三级模块名称、功能说明
     - 为每个角色分配工作天数
     - 设置交付系数（默认1.0）
     - 自动计算：工时 = Σ(角色工作天数) × 交付系数
  
  2. **系统对接工作量**
     - 与新功能开发类似的表格结构
     - 用于评估与外部系统集成的工作量

**步骤三：其他成本**
- **差旅成本**
  - 输入差旅月数
  - 系统根据配置的差旅成本标准自动计算
  
- **运维成本**
  - 输入运维月数和平均每月投入人数
  - 计算公式：运维成本 = 运维月数 × 人数 × 人力单价
  
- **风险成本**
  - 支持添加多个风险项
  - 每个风险项包含：风险描述、预估费用

**步骤四：生成总览**
- **功能**：汇总所有评估数据，计算最终报价
- **显示内容**：
  - 软件研发成本
  - 系统对接成本
  - 差旅成本
  - 运维成本
  - 风险成本
  - 报价总计
  
- **保存功能**：
  - 输入项目名称（必填）
  - 可选择保存为模板
  - 提交后跳转到历史项目页面

##### 模板功能
- **从模板创建**：页面顶部提供模板选择下拉框，选择后自动填充所有表单数据
- **保存为模板**：在保存时可勾选"另存为模板"，供后续项目复用

#### 2.2.2 历史项目 (`/assessment/history`)

##### 功能描述
展示所有已保存的项目评估记录，支持查看、编辑、删除操作。

##### 功能要素
- **列表展示**
  - 项目名称（可点击查看详情）
  - 报价总计
  - 风险总分
  - 创建时间
  
- **操作功能**
  - 查看：跳转到项目详情页
  - 编辑：跳转到新建评估页面，加载项目数据
  - 删除：弹出确认框后删除项目
  
- **搜索排序**
  - 支持按项目名称搜索
  - 支持按成本、风险分数、创建时间排序
  
- **分页**：每页显示10条记录

#### 2.2.3 项目详情 (`/assessment/detail/:id`)

##### 功能描述
展示项目的完整评估结果，支持导出为PDF或Excel格式。

##### 功能要素
- **基本信息**：项目名称、描述、创建时间
- **评估结果**：
  - 风险评分明细
  - 工作量估算明细
  - 成本构成明细
  - 总计报价
  
- **导出功能**
  - PDF导出：生成专业的评估报告
  - Excel导出：导出原始数据供进一步分析

### 2.3 参数配置模块 (`/config`)

#### 2.3.1 功能描述
管理系统中用于计算的各项参数，实现评估模型的灵活配置。

#### 2.3.2 子模块

##### 角色与单价管理
- **功能**：配置项目中的角色类型及其人力单价
- **字段**：
  - 角色名称（如：项目经理、开发工程师、测试工程师等）
  - 人力单价（元/人天）
- **操作**：新增、编辑、删除

##### 风险评估项管理
- **功能**：配置风险评估的类别、评估项及选项
- **字段**：
  - 评估类别（如：技术风险、管理风险等）
  - 评估项名称
  - 选项配置（JSON格式，包含选项描述和分值）
- **操作**：新增、编辑、删除

##### 差旅成本管理
- **功能**：配置差旅相关的成本标准
- **字段**：
  - 费用项目（如：交通、住宿、餐补等）
  - 月度费用（元/月）
- **操作**：新增、编辑、删除

## 3. 数据模型

### 3.1 核心数据表

#### projects 表
| 字段 | 类型 | 说明 |
|-----|------|------|
| id | INTEGER | 主键 |
| name | TEXT | 项目名称 |
| description | TEXT | 项目描述 |
| is_template | BOOLEAN | 是否为模板 |
| final_total_cost | REAL | 总成本 |
| final_risk_score | INTEGER | 风险总分 |
| final_workload_days | REAL | 总工作量（人天）|
| assessment_details_json | TEXT | 评估详情（JSON）|
| created_at | DATETIME | 创建时间 |
| updated_at | DATETIME | 更新时间 |

#### config_roles 表
| 字段 | 类型 | 说明 |
|-----|------|------|
| id | INTEGER | 主键 |
| role_name | TEXT | 角色名称 |
| unit_price | REAL | 单价（万元/人天）|
| is_active | BOOLEAN | 是否启用 |

#### config_risk_items 表
| 字段 | 类型 | 说明 |
|-----|------|------|
| id | INTEGER | 主键 |
| category | TEXT | 风险类别 |
| item_name | TEXT | 评估项名称 |
| options_json | TEXT | 选项配置（JSON）|
| is_active | BOOLEAN | 是否启用 |

#### config_travel_costs 表
| 字段 | 类型 | 说明 |
|-----|------|------|
| id | INTEGER | 主键 |
| item_name | TEXT | 费用项目 |
| cost_per_month | REAL | 月度费用 |
| is_active | BOOLEAN | 是否启用 |

## 4. API接口规范

### 4.1 项目管理接口

| 接口 | 方法 | 说明 |
|------|------|------|
| /api/projects | GET | 获取项目列表 |
| /api/projects/:id | GET | 获取项目详情 |
| /api/projects | POST | 创建项目 |
| /api/projects/:id | PUT | 更新项目 |
| /api/projects/:id | DELETE | 删除项目 |
| /api/calculate | POST | 计算项目成本 |

### 4.2 配置管理接口

| 接口 | 方法 | 说明 |
|------|------|------|
| /api/config/roles | GET/POST | 角色管理 |
| /api/config/roles/:id | PUT/DELETE | 角色编辑/删除 |
| /api/config/risk-items | GET/POST | 风险项管理 |
| /api/config/risk-items/:id | PUT/DELETE | 风险项编辑/删除 |
| /api/config/travel-costs | GET/POST | 差旅成本管理 |
| /api/config/travel-costs/:id | PUT/DELETE | 差旅成本编辑/删除 |

## 5. 业务规则

### 5.1 计算规则

1. **工作量成本计算**
   ```
   功能成本 = Σ(角色工作天数 × 角色单价 × 交付系数)
   ```

2. **差旅成本计算**
   ```
   差旅成本 = 差旅月数 × 月度差旅标准
   ```

3. **运维成本计算**
   ```
   运维成本 = 运维月数 × 人数 × 人力单价
   ```

4. **风险成本计算**
   ```
   风险成本 = Σ(各风险项预估费用)
   ```

5. **总成本计算**
   ```
   总成本 = 软件研发成本 + 系统对接成本 + 差旅成本 + 运维成本 + 风险成本
   ```

### 5.2 数据验证规则

1. 所有必填字段不能为空
2. 数值类型字段必须大于等于0
3. 风险评分必须选择所有评估项
4. 项目名称在非模板项目中必须唯一
5. 角色名称在配置中必须唯一