# 模型配置与测试改造计划

目标：统一走 OpenAI 兼容协议，移除默认 host/key/model/path 兜底；前端配置“完整 URL”即可（含协议和路径），不再自动拼接。测试按钮执行真实推理（固定 prompt：“你是什么模型？”），并通过现有文件日志记录请求/响应。移除 Azure 选项（仅保留普通 OpenAI 兼容及静态供应商标签）。

## 后端改造
- Provider 收敛：用一个 OpenAI 兼容调用；`api_host` 视为完整 URL（含协议与路径），不再自动拼 `/v1/chat/completions`，不再使用环境兜底 host/key/model。保留 provider 字段仅供展示区分。
- 调用路由：风险评估 / 模块分析 / 工作量评估等服务移除 doubao 特判，统一走兼容 provider；确保 timeout 取配置（可设最小下限），移除温度/max_tokens/timeout 的环境默认值，必要时仅在后端做安全兜底。
- 连接测试：`aiTestService` 调用同一 provider，发送固定 prompt “你是什么模型？”，以 200 且有内容为成功；失败返回错误信息。测试结果写入 `aiFileLogger`（包含 requestHash、模型配置、请求 prompt、响应、耗时、状态）。

## 前端改造
- 服务商选项：移除 Azure 选项，其余为静态标签，不影响路由。
- 表单说明：提示/placeholder 改为“填写完整接口 URL（含协议和路径）、API Key、模型/部署 ID”；去掉 Doubao 特定提示与 host/path 默认说明。
- 参数默认值：弱化/去掉前端默认温度/max_tokens/timeout，或明确显示默认值来源；与后端一致。
- 测试按钮：提示会发送真实请求并耗费配额；展示响应耗时与结果文案与后端新逻辑对齐。

## 验证与交付
- 手工验证：新建配置（填完整 URL）、测试按钮成功/失败分支、设为当前、实际评估调用正常。
- 自动化：补充/更新必要的后端测试（冒烟或单测）覆盖新测试逻辑和无默认兜底场景。
- 文档：更新必要的 README/提示，说明需填写完整 URL 与固定测试问句。
