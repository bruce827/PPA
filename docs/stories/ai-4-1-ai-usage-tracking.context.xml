<?xml version="1.0" encoding="UTF-8"?>
<story-context id="bmad/bmm/workflows/4-implementation/story-context/template" v="1.0">
  <metadata>
    <epicId>AI-4</epicId>
    <storyId>AI-4.1</storyId>
    <title>AIä½¿ç”¨æƒ…å†µæ ‡æ³¨ä¸è¿½æº¯åŠŸèƒ½</title>
    <status>drafted</status>
    <generatedAt>2025-11-12T04:52:00.000Z</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/stories/ai-4-1-ai-usage-tracking.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>ä½œä¸ºä¸€åé¡¹ç›®è¯„ä¼°äººå‘˜æˆ–ç®¡ç†è€…</asA>
    <iWant>åœ¨æ€»è§ˆé¡µé¢ä¸Šçœ‹åˆ°æ¸…æ™°çš„"AIä½¿ç”¨æƒ…å†µ"æ‘˜è¦</iWant>
    <soThat>ä»¥ä¾¿å‡†ç¡®äº†è§£åœ¨æœ¬æ¬¡è¯„ä¼°ä¸­å“ªäº›ç¯èŠ‚ä½¿ç”¨äº†AIè¾…åŠ©ã€è°ƒç”¨äº†å“ªä¸ªAIæ¨¡å‹ä»¥åŠä½¿ç”¨äº†å“ªä¸ªæç¤ºè¯æ¨¡æ¿,ç¡®ä¿æ•´ä¸ªè¯„ä¼°è¿‡ç¨‹çš„é€æ˜æ€§å’Œå¯è¿½æº¯æ€§</soThat>
    <tasks>
      <task id="1" name="åœ¨Overviewç»„ä»¶ä¸­æ·»åŠ AIä½¿ç”¨æƒ…å†µé¢æ¿" status="pending">
        <description>åœ¨Overviewç»„ä»¶æ¸²æŸ“æ—¶æ·»åŠ AIä½¿ç”¨æƒ…å†µæ”¶é›†å’Œå±•ç¤ºé€»è¾‘</description>
        <ac>[AC1, AC2]</ac>
        <files>frontend/ppa_frontend/src/pages/Assessment/components/Overview.tsx</files>
      </task>
      <task id="2" name="å®ç°collectAIUsageInfoå‡½æ•°" status="pending">
        <description>åˆ›å»ºæ”¶é›†AIä½¿ç”¨ä¿¡æ¯çš„æ ¸å¿ƒå‡½æ•°</description>
        <ac>[AC2]</ac>
      </task>
      <task id="3" name="è®¾è®¡AIä½¿ç”¨æƒ…å†µå±•ç¤ºUI" status="pending">
        <description>åˆ›å»ºAIæ¨¡å‹ä½¿ç”¨æƒ…å†µCardç»„ä»¶</description>
        <ac>[AC1]</ac>
      </task>
      <task id="4" name="å®ç°AIä½¿ç”¨è®°å½•æ•°æ®ç»“æ„" status="pending">
        <description>å®šä¹‰AIä½¿ç”¨è®°å½•çš„æ•°æ®ç»“æ„å’Œå­˜å‚¨æ ¼å¼</description>
        <ac>[AC2]</ac>
      </task>
      <task id="5" name="æ·»åŠ AIä½¿ç”¨æƒ…å†µæ ‡æ³¨æ ·å¼" status="pending">
        <description>ä¸ºAIä½¿ç”¨æƒ…å†µé¢æ¿æ·»åŠ ä¸“ç”¨æ ·å¼</description>
        <ac>[AC1]</ac>
      </task>
    </tasks>
  </story>

  <acceptanceCriteria>
    <criterion id="AC1">
      <given>ç”¨æˆ·å®Œæˆè¯„ä¼°åˆ°è¾¾ç¬¬å››æ­¥æ€»è§ˆé¡µé¢</given>
      <when>ç”¨æˆ·æŸ¥çœ‹Overviewç»„ä»¶</when>
      <then>åœ¨æ€»è§ˆå†…å®¹ä¸‹æ–¹æ˜¾ç¤º"ğŸ¤– AIæ¨¡å‹ä½¿ç”¨æƒ…å†µ"Card</then>
      <and>Cardä½¿ç”¨ç‹¬ç«‹çš„.ai-usage-annotationå®¹å™¨</and>
      <and>é¢æ¿åœ¨"ç»§ç»­æŒ‰é’®"ä¹‹å‰æ˜¾ç¤º</and>
      <and>é¢æ¿å…·æœ‰ç‰¹æ®Šçš„è§†è§‰æ ·å¼(è¾¹æ¡†å’ŒèƒŒæ™¯è‰²)</and>
    </criterion>
    <criterion id="AC2">
      <given>Overviewç»„ä»¶æ¸²æŸ“</given>
      <when>ç»„ä»¶åŠ è½½æ—¶(useEffect)</when>
      <then>æ‰§è¡ŒcollectAIUsageInfoå‡½æ•°</then>
      <and>æ£€æŸ¥assessmentData.ai_assessment_result(é£é™©è¯„ä¼°)</and>
      <and>æ£€æŸ¥assessmentData.ai_module_analysis(æ¨¡å—åˆ†æ)</and>
      <and>éå†development_workloadæ£€æŸ¥ai_evaluation_result</and>
      <and>éå†integration_workloadæ£€æŸ¥ai_evaluation_result</and>
      <and>æ±‡æ€»æ‰€æœ‰AIä½¿ç”¨ä¿¡æ¯åˆ°aiUsageInfoçŠ¶æ€</and>
      <and>è®°å½•æ”¶é›†æ—¶é—´æˆ³</and>
    </criterion>
  </acceptanceCriteria>

  <artifacts>
    <docs>
      <doc path="docs/PRD.md" title="è½¯ä»¶é¡¹ç›®è¯„ä¼°ç³»ç»Ÿäº§å“éœ€æ±‚æ–‡æ¡£">
        <section>ç¬¬1-2ç« ï¼šäº§å“æ„¿æ™¯ä¸ç›®æ ‡</section>
        <snippet>PPAæ˜¯ä¸€ä¸ªé¢å‘è½¯ä»¶é¡¹ç›®æˆæœ¬å’Œé£é™©è¯„ä¼°çš„ä¸“ä¸šWebåº”ç”¨å¹³å°ï¼Œé€šè¿‡ç®—æ³•åŒ–çš„è¯„ä¼°æ–¹æ³•ã€æ¨¡æ¿åŒ–çš„å·¥ä½œæµç¨‹å’Œæ•°æ®é©±åŠ¨çš„æ´å¯Ÿèƒ½åŠ›ï¼Œä¸ºç»„ç»‡æä¾›ç»Ÿä¸€çš„é¡¹ç›®è¯„ä¼°æ ‡å‡†ã€‚</snippet>
      </doc>
      <doc path="docs/tech-spec.md" title="è½¯ä»¶é¡¹ç›®è¯„ä¼°ç³»ç»ŸæŠ€æœ¯è§„èŒƒ">
        <section>ç¬¬2-3ç« ï¼šæŠ€æœ¯æ¶æ„ä¸æ•°æ®åº“è®¾è®¡</section>
        <snippet>é‡‡ç”¨React + Ant Designå‰ç«¯ï¼ŒNode.js + Expressåç«¯ï¼ŒSQLite3æ•°æ®åº“ï¼Œå®ç°å®Œæ•´çš„é¡¹ç›®è¯„ä¼°ç³»ç»Ÿæ¶æ„ã€‚</snippet>
      </doc>
      <doc path="docs/new-assessment-ai-design-step2.md" title="æ–°å»ºè¯„ä¼°é¡µé¢AIæ™ºèƒ½å·¥ä½œé‡ä¼°ç®—åŠŸèƒ½è®¾è®¡">
        <section>ç¬¬1-100è¡Œï¼šAIå·¥ä½œé‡ä¼°ç®—åŠŸèƒ½è¯¦ç»†è®¾è®¡</section>
        <snippet>åŸºäºé¡¹ç›®æè¿°çš„AIæ¨¡å—åˆ†æåŠŸèƒ½ï¼Œä¸ºå•ä¸ªæ¨¡å—æä¾›æ™ºèƒ½å·¥ä½œé‡è¯„ä¼°å’Œè§’è‰²å·¥ä½œåˆ†é…å»ºè®®ã€‚</snippet>
      </doc>
      <doc path="docs/ai-integration-requirements.md" title="AIé›†æˆéœ€æ±‚æ–‡æ¡£">
        <section>AIä½¿ç”¨æƒ…å†µå’Œè¿½æº¯éœ€æ±‚</section>
        <snippet>ç³»ç»Ÿéœ€è¦è¿½è¸ªå’Œè®°å½•æ‰€æœ‰AIè¾…åŠ©åŠŸèƒ½çš„ä½¿ç”¨æƒ…å†µï¼Œç¡®ä¿è¯„ä¼°è¿‡ç¨‹çš„é€æ˜æ€§å’Œå¯è¿½æº¯æ€§ã€‚</snippet>
      </doc>
    </docs>
    <code>
      <file path="frontend/ppa_frontend/src/pages/Assessment/components/Overview.tsx" kind="component">
        <symbol>Overview</symbol>
        <lines>1-50</lines>
        <reason>æ€»è§ˆé¡µé¢ä¸»ç»„ä»¶ï¼Œéœ€è¦åœ¨æ­¤æ·»åŠ AIä½¿ç”¨æƒ…å†µé¢æ¿</reason>
      </file>
      <file path="frontend/ppa_frontend/src/pages/Assessment/components/WorkloadEstimation.tsx" kind="component">
        <symbol>handleApplyEvaluation</symbol>
        <lines>240-250</lines>
        <reason>å·²å®ç°çš„AIè¯„ä¼°ç»“æœè®°å½•ï¼ŒåŒ…å«ai_evaluation_resultæ•°æ®ç»“æ„</reason>
      </file>
      <file path="frontend/ppa_frontend/src/pages/Assessment/New.tsx" kind="component">
        <symbol>New Assessment</symbol>
        <lines>420-430</lines>
        <reason>è¯„ä¼°æµç¨‹ä¸»ç»„ä»¶ï¼ŒåŒ…å«Overviewç»„ä»¶çš„è°ƒç”¨</reason>
      </file>
    </code>
    <dependencies>
      <framework name="react" version="18+"/>
      <framework name="antd" version="5+"/>
      <framework name="typescript" version="5+"/>
      <library name="@ant-design/pro-components"/>
      <library name="@ant-design/icons"/>
      <library name="@umijs/max"/>
    </dependencies>
  </artifacts>

  <constraints>
    <constraint type="æŠ€æœ¯æ ˆ">
      <description>å¿…é¡»ä½¿ç”¨UMI Max + React + TypeScript + Ant DesignæŠ€æœ¯æ ˆ</description>
      <source>docs/tech-spec.md ç¬¬2ç« </source>
    </constraint>
    <constraint type="UIç»„ä»¶">
      <description>å¿…é¡»ä½¿ç”¨Ant Designç»„ä»¶åº“ï¼Œç¡®ä¿ç•Œé¢ä¸€è‡´æ€§</description>
      <source>docs/tech-spec.md ç¬¬2ç« </source>
    </constraint>
    <constraint type="æ•°æ®æµ">
      <description>AIä½¿ç”¨æƒ…å†µæ•°æ®å¿…é¡»ä»ç°æœ‰AIåŠŸèƒ½ä¸­æ”¶é›†ï¼šai_assessment_resultã€ai_module_analysisã€ai_evaluation_result</description>
      <source>æ•…äº‹AC2è¦æ±‚</source>
    </constraint>
    <constraint type="å¸ƒå±€">
      <description>AIä½¿ç”¨æƒ…å†µé¢æ¿å¿…é¡»åœ¨"ç»§ç»­æŒ‰é’®"ä¹‹å‰æ˜¾ç¤º</description>
      <source>æ•…äº‹AC1è¦æ±‚</source>
    </constraint>
    <constraint type="æ ·å¼">
      <description>AIä½¿ç”¨æƒ…å†µé¢æ¿éœ€è¦ç‰¹æ®Šè§†è§‰æ ·å¼åŒºåˆ†äºå…¶ä»–å†…å®¹</description>
      <source>æ•…äº‹AC1è¦æ±‚</source>
    </constraint>
  </constraints>

  <interfaces>
    <interface name="AIUsageInfo" kind="æ•°æ®æ¥å£">
      <signature>
        interface AIUsageInfo {
          riskAssessment: {
            used: boolean;
            modelName?: string;
            modelProvider?: string;
            timestamp?: string;
          };
          moduleAnalysis: {
            used: boolean;
            modelName?: string;
            modelProvider?: string;
            timestamp?: string;
          };
          workloadEvaluations: Array<{
            recordId: string;
            module1: string;
            module2: string;
            module3: string;
            aiResult: {
              used: boolean;
              modelName?: string;
              modelProvider?: string;
              promptTemplate?: string;
              timestamp?: string;
              confidence?: number;
            };
          }>;
          collectedAt: string;
        }
      </signature>
      <path>å‰ç«¯ç»„ä»¶ä¸­å®šä¹‰</path>
    </interface>
    <interface name="collectAIUsageInfo" kind="å‡½æ•°æ¥å£">
      <signature>
        const collectAIUsageInfo = (assessmentData: API.AssessmentData): AIUsageInfo
      </signature>
      <path>frontend/ppa_frontend/src/pages/Assessment/components/Overview.tsx (å¾…å®ç°)</path>
    </interface>
    <interface name="assessmentData" kind="æ•°æ®ç»“æ„">
      <signature>
        interface AssessmentData {
          // ç°æœ‰æ•°æ®ç»“æ„
          ai_assessment_result?: any;
          ai_module_analysis?: any;
          development_workload?: Array<WorkloadRecord & { ai_evaluation_result?: AIEvaluationResult }>;
          integration_workload?: Array<WorkloadRecord & { ai_evaluation_result?: AIEvaluationResult }>;
        }
      </signature>
      <path>APIç±»å‹å®šä¹‰</path>
    </interface>
  </interfaces>

  <tests>
    <standards>
      ä½¿ç”¨Jestè¿›è¡Œå•å…ƒæµ‹è¯•ï¼ŒCypressè¿›è¡Œç«¯åˆ°ç«¯æµ‹è¯•ã€‚éµå¾ªç°æœ‰æµ‹è¯•æ¨¡å¼ï¼šç»„ä»¶æµ‹è¯•ã€APIæµ‹è¯•ã€é›†æˆæµ‹è¯•ã€‚æµ‹è¯•æ–‡ä»¶æ”¾åœ¨tests/ç›®å½•ä¸‹ï¼Œä¸è¢«æµ‹è¯•æ–‡ä»¶åŒåã€‚
    </standards>
    <locations>
      <location>tests/components/Overview.test.tsx</location>
      <location>tests/integration/ai-usage-tracking.test.tsx</location>
      <location>cypress/integration/ai-usage-tracking.spec.js</location>
    </locations>
    <ideas>
      <test id="TC1" ac="AC1" title="AIä½¿ç”¨æƒ…å†µé¢æ¿æ˜¾ç¤ºæµ‹è¯•">
        <description>éªŒè¯Overviewç»„ä»¶æ¸²æŸ“æ—¶æ˜¾ç¤ºAIä½¿ç”¨æƒ…å†µCardï¼Œé¢æ¿ä½ç½®å’Œæ ·å¼æ­£ç¡®</description>
      </test>
      <test id="TC2" ac="AC2" title="AIä½¿ç”¨ä¿¡æ¯æ”¶é›†æµ‹è¯•">
        <description>éªŒè¯collectAIUsageInfoå‡½æ•°æ­£ç¡®æ”¶é›†æ‰€æœ‰AIä½¿ç”¨æ•°æ®ï¼ŒåŒ…æ‹¬é£é™©è¯„ä¼°ã€æ¨¡å—åˆ†æå’Œå·¥ä½œé‡è¯„ä¼°</description>
      </test>
      <test id="TC3" ac="AC1,AC2" title="AIä½¿ç”¨æƒ…å†µæ•°æ®å±•ç¤ºæµ‹è¯•">
        <description>éªŒè¯AIä½¿ç”¨ä¿¡æ¯æ­£ç¡®å±•ç¤ºï¼ŒåŒ…æ‹¬ä½¿ç”¨çš„AIåŠŸèƒ½ã€æ¨¡å‹ä¿¡æ¯å’Œæ—¶é—´æˆ³</description>
      </test>
      <test id="TC4" ac="AC2" title="AIä½¿ç”¨è®°å½•å®Œæ•´æ€§æµ‹è¯•">
        <description>éªŒè¯æ‰€æœ‰AIè¯„ä¼°è®°å½•éƒ½è¢«æ­£ç¡®è¯†åˆ«å’Œè®°å½•ï¼ŒåŒ…æ‹¬devå’Œintegrationå·¥ä½œé‡</description>
      </test>
    </ideas>
  </tests>
</story-context>
