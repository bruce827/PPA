<story-context id="bmad/bmm/workflows/4-implementation/story-context/template" v="1.0">
  <metadata>
    <epicId>1</epicId>
    <storyId>1.3</storyId>
    <title>æç¤ºè¯æ¨¡æ¿åŸºç¡€ç®¡ç†</title>
    <status>Ready</status>
    <generatedAt>2025-10-24T12:00:00.000Z</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>/Users/maylis/Desktop/githubä¸Šçš„é¡¹ç›®/é¡¹ç›®è¯„ä¼°ç³»ç»Ÿ/PPA/docs/stories/story-1.3.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>ç³»ç»Ÿç®¡ç†å‘˜ï¼ˆSystem Administratorï¼‰æˆ–é¡¹ç›®ç»ç†ï¼ˆProject Managerï¼‰</asA>
    <iWant>ç®¡ç† AI æç¤ºè¯æ¨¡æ¿ï¼ˆåˆ›å»ºã€æŸ¥çœ‹ã€ç¼–è¾‘ã€åˆ é™¤ï¼‰</iWant>
    <soThat>ä¸ºä¸åŒçš„ AI åº”ç”¨åœºæ™¯é…ç½®å’Œå¤ç”¨æç¤ºè¯ã€‚</soThat>
    <tasks>
- [ ] åç«¯æ•°æ®å±‚å®ç° (AC: #1)
  - [ ] åˆ›å»ºæ•°æ®åº“è¿ç§»è„šæœ¬ `server/migrations/002_create_prompt_templates.js`
  - [ ] å®šä¹‰è¡¨ç»“æ„å’Œç´¢å¼•
  - [ ] ç¼–å†™è¿ç§»è„šæœ¬çš„ up/down æ–¹æ³•
  - [ ] æ‰§è¡Œè¿ç§»å¹¶éªŒè¯è¡¨åˆ›å»ºæˆåŠŸ

- [ ] åç«¯ API å®ç° (AC: #2, #3, #4, #5, #6)
  - [ ] åˆ›å»ºæ§åˆ¶å™¨ `server/controllers/promptTemplateController.js`
  - [ ] å®ç° createPromptTemplate æ–¹æ³•ï¼ˆPOSTï¼‰
  - [ ] å®ç° getPromptTemplates æ–¹æ³•ï¼ˆGETï¼Œæ”¯æŒç­›é€‰å’Œæœç´¢ï¼‰
  - [ ] å®ç° getPromptTemplateById æ–¹æ³•ï¼ˆGET /:idï¼‰
  - [ ] å®ç° updatePromptTemplate æ–¹æ³•ï¼ˆPUT /:idï¼Œå«æƒé™æ£€æŸ¥ï¼‰
  - [ ] å®ç° deletePromptTemplate æ–¹æ³•ï¼ˆDELETE /:idï¼Œå«æƒé™æ£€æŸ¥ï¼‰
  - [ ] åœ¨ `server/routes/index.js` ä¸­æ³¨å†Œè·¯ç”±
  - [ ] æ·»åŠ è¯·æ±‚å‚æ•°éªŒè¯ä¸­é—´ä»¶
  - [ ] ç¼–å†™ API æµ‹è¯•ç”¨ä¾‹ï¼ˆPostman æˆ– Jestï¼‰

- [ ] å‰ç«¯æœåŠ¡å±‚å®ç° (AC: #7, #8)
  - [ ] åˆ›å»º API æœåŠ¡æ–‡ä»¶ `frontend/ppa_frontend/src/services/promptTemplate.ts`
  - [ ] å®šä¹‰ TypeScript æ¥å£ï¼š
    * PromptVariable æ¥å£ï¼ˆname, description, example, requiredï¼‰
    * PromptTemplate æ¥å£ï¼ˆå®Œæ•´å­—æ®µå®šä¹‰ï¼‰
  - [ ] å®ç° getPromptTemplates æ–¹æ³•ï¼ˆæ”¯æŒæŸ¥è¯¢å‚æ•°ï¼‰
  - [ ] å®ç° getPromptTemplateById æ–¹æ³•
  - [ ] å®ç° createPromptTemplate æ–¹æ³•
  - [ ] å®ç° updatePromptTemplate æ–¹æ³•
  - [ ] å®ç° deletePromptTemplate æ–¹æ³•

- [ ] å‰ç«¯åˆ—è¡¨é¡µé¢å®ç° (AC: #7)
  - [ ] åˆ›å»ºé¡µé¢ç»„ä»¶ `frontend/ppa_frontend/src/pages/ModelConfig/Prompts/index.tsx`
  - [ ] é…ç½®è·¯ç”±ï¼ˆåœ¨ `.umirc.ts` ä¸­ï¼‰
  - [ ] å®ç° ProTable è¡¨æ ¼ï¼š
    * å®šä¹‰åˆ—é…ç½®ï¼ˆæŒ‰ AC #7 è§„æ ¼ï¼‰
    * å®ç°ç­›é€‰åŠŸèƒ½ï¼ˆåˆ†ç±»ã€ç±»å‹ã€çŠ¶æ€ï¼‰
    * å®ç°æœç´¢åŠŸèƒ½
    * å®ç°æ’åºåŠŸèƒ½
  - [ ] å®ç°é¡¶éƒ¨å·¥å…·æ ï¼š
    * "æ–°å»ºæ¨¡æ¿"æŒ‰é’®ï¼ˆè·³è½¬åˆ°åˆ›å»ºé¡µé¢ï¼‰
    * æ ‡ç­¾ç­›é€‰æŒ‰é’®
    * æœç´¢æ¡†
  - [ ] å®ç°æ“ä½œåˆ—æŒ‰é’®ï¼š
    * æŸ¥çœ‹æŒ‰é’®ï¼ˆè·³è½¬è¯¦æƒ…é¡µï¼‰
    * ç¼–è¾‘æŒ‰é’®ï¼ˆè·³è½¬ç¼–è¾‘é¡µï¼Œç³»ç»Ÿæ¨¡æ¿æ˜¾ç¤ºä¸º"æŸ¥çœ‹"ï¼‰
    * åˆ é™¤æŒ‰é’®ï¼ˆå«äºŒæ¬¡ç¡®è®¤ï¼Œç³»ç»Ÿæ¨¡æ¿ç¦ç”¨ï¼‰
  - [ ] å®ç°åˆ†é¡µåŠŸèƒ½
  - [ ] æ·»åŠ ç©ºçŠ¶æ€æç¤º

- [ ] å‰ç«¯æ–°å»º/ç¼–è¾‘è¡¨å•å®ç° (AC: #8)
  - [ ] åˆ›å»ºè¡¨å•ç»„ä»¶ `frontend/ppa_frontend/src/pages/ModelConfig/Prompts/Form.tsx`
  - [ ] é…ç½®è·¯ç”±ï¼ˆåˆ›å»ºå’Œç¼–è¾‘å…±ç”¨åŒä¸€ç»„ä»¶ï¼‰
  - [ ] å®ç° ProForm è¡¨å•ï¼š
    * åŸºç¡€ä¿¡æ¯æ®µï¼ˆæ¨¡æ¿åç§°ã€åˆ†ç±»ã€æè¿°ï¼‰
    * ç³»ç»Ÿæç¤ºè¯æ®µï¼ˆæ–‡æœ¬åŸŸï¼Œå¸¦è¯´æ˜ï¼‰
    * ç”¨æˆ·æç¤ºè¯æ¨¡æ¿æ®µï¼ˆæ–‡æœ¬åŸŸï¼Œå¸¦è¯´æ˜ï¼‰
  - [ ] å®ç°è¡¨å•éªŒè¯è§„åˆ™
  - [ ] å®ç°ä¿å­˜é€»è¾‘ï¼ˆåŒºåˆ†åˆ›å»º/ç¼–è¾‘ï¼‰
  - [ ] å®ç°å–æ¶ˆé€»è¾‘ï¼ˆè¿”å›åˆ—è¡¨é¡µï¼‰
  - [ ] ç³»ç»Ÿæ¨¡æ¿åªè¯»æ¨¡å¼ï¼š
    * æ£€æµ‹ is_system å­—æ®µ
    * è®¾ç½®æ‰€æœ‰è¡¨å•å­—æ®µä¸º disabled
    * ä¿å­˜æŒ‰é’®ç¦ç”¨æˆ–éšè—
  - [ ] æ·»åŠ æˆåŠŸ/å¤±è´¥æç¤º

- [ ] æƒé™å’Œäº¤äº’ä¼˜åŒ– (AC: #9)
  - [ ] å®ç°ç³»ç»Ÿæ¨¡æ¿çš„ç¼–è¾‘é™åˆ¶é€»è¾‘
  - [ ] å®ç°åˆ é™¤ç¡®è®¤å¯¹è¯æ¡†
  - [ ] æ·»åŠ æ“ä½œæŒ‰é’®çš„ç¦ç”¨çŠ¶æ€å’Œæç¤º
  - [ ] å®ç°ç©ºçŠ¶æ€å±•ç¤º

- [ ] æµ‹è¯•å’Œæ–‡æ¡£ (å…¨éƒ¨ AC)
  - [ ] ç¼–å†™åç«¯ API å•å…ƒæµ‹è¯•
  - [ ] ç¼–å†™å‰ç«¯ç»„ä»¶æµ‹è¯•ï¼ˆå¯é€‰ï¼‰
  - [ ] æ‰‹åŠ¨æµ‹è¯•å®Œæ•´æµç¨‹ï¼š
    * åˆ›å»ºç”¨æˆ·æ¨¡æ¿
    * æŸ¥çœ‹ç³»ç»Ÿæ¨¡æ¿ï¼ˆåªè¯»ï¼‰
    * ç¼–è¾‘ç”¨æˆ·æ¨¡æ¿
    * åˆ é™¤ç”¨æˆ·æ¨¡æ¿
    * ç­›é€‰å’Œæœç´¢
  - [ ] æ›´æ–°ç”¨æˆ·æ–‡æ¡£ï¼ˆæ“ä½œæ‰‹å†Œï¼‰</tasks>
  </story>

  <acceptanceCriteria>
1. **æ•°æ®åº“è¡¨åˆ›å»º** (æ•°æ®å±‚)
   - åˆ›å»º `prompt_templates` è¡¨ï¼ŒåŒ…å«å­—æ®µï¼š
     * id (ä¸»é”®ï¼Œè‡ªå¢)
     * template_name (æ¨¡æ¿åç§°ï¼Œå¿…å¡«)
     * category (åˆ†ç±»ï¼šrisk_analysis/cost_estimation/report_generation/custom)
     * description (æ¨¡æ¿æè¿°ï¼Œå¯é€‰)
     * system_prompt (ç³»ç»Ÿæç¤ºè¯ï¼Œå¿…å¡«ï¼ŒTEXT)
     * user_prompt_template (ç”¨æˆ·æç¤ºè¯æ¨¡æ¿ï¼Œå¿…å¡«ï¼ŒTEXT)
     * variables_json (å˜é‡å®šä¹‰ï¼ŒJSON æ ¼å¼ï¼Œå­˜å‚¨æ•°ç»„)
     * is_system (æ˜¯å¦ç³»ç»Ÿé¢„ç½®ï¼Œå¸ƒå°”å€¼ï¼Œé»˜è®¤ false)
     * is_active (æ˜¯å¦å¯ç”¨ï¼Œå¸ƒå°”å€¼ï¼Œé»˜è®¤ true)
     * created_at (åˆ›å»ºæ—¶é—´ï¼Œé»˜è®¤å½“å‰æ—¶é—´)
     * updated_at (æ›´æ–°æ—¶é—´ï¼Œé»˜è®¤å½“å‰æ—¶é—´)
   - åˆ›å»ºç´¢å¼•ï¼š
     * idx_prompt_category (category)
     * idx_prompt_active (is_active)
     * idx_prompt_system (is_system)

2. **åˆ›å»ºæç¤ºè¯æ¨¡æ¿ API** (åç«¯æ¥å£å±‚)
   - å®ç° `POST /api/config/prompts` API æ¥å£
   - è¯·æ±‚ä½“éªŒè¯ï¼š
     * template_name: å¿…å¡«ï¼Œæœ€å¤š 100 å­—ç¬¦
     * category: å¿…å¡«ï¼Œæšä¸¾å€¼éªŒè¯
     * system_prompt: å¿…å¡«
     * user_prompt_template: å¿…å¡«
     * variables_json: å¯é€‰ï¼ŒéªŒè¯ JSON æ ¼å¼
   - è‡ªåŠ¨è®¾ç½® is_system=falseï¼ˆç”¨æˆ·åˆ›å»ºçš„æ¨¡æ¿ï¼‰
   - è¿”å›åˆ›å»ºçš„æ¨¡æ¿å®Œæ•´ä¿¡æ¯ï¼ˆåŒ…å«ç”Ÿæˆçš„ IDï¼‰

3. **æŸ¥è¯¢æç¤ºè¯æ¨¡æ¿åˆ—è¡¨ API** (åç«¯æ¥å£å±‚)
   - å®ç° `GET /api/config/prompts` API æ¥å£
   - æ”¯æŒæŸ¥è¯¢å‚æ•°ï¼š
     * category: æŒ‰åˆ†ç±»ç­›é€‰
     * is_system: ç­›é€‰ç³»ç»Ÿ/ç”¨æˆ·æ¨¡æ¿
     * is_active: ç­›é€‰å¯ç”¨/ç¦ç”¨æ¨¡æ¿
     * search: æŒ‰æ¨¡æ¿åç§°æ¨¡ç³Šæœç´¢
   - è¿”å›æ¨¡æ¿åˆ—è¡¨ï¼ŒåŒ…å«ï¼š
     * åŸºç¡€ä¿¡æ¯ï¼ˆid, template_name, category, descriptionï¼‰
     * çŠ¶æ€ï¼ˆis_system, is_activeï¼‰
     * å˜é‡æ•°é‡ï¼ˆä» variables_json è§£æï¼‰
     * æ—¶é—´æˆ³ï¼ˆcreated_at, updated_atï¼‰
   - æŒ‰åˆ›å»ºæ—¶é—´å€’åºæ’åº

4. **æŸ¥è¯¢å•ä¸ªæ¨¡æ¿è¯¦æƒ… API** (åç«¯æ¥å£å±‚)
   - å®ç° `GET /api/config/prompts/:id` API æ¥å£
   - è¿”å›æŒ‡å®šæ¨¡æ¿çš„å®Œæ•´ä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼š
     * æ‰€æœ‰åŸºç¡€å­—æ®µ
     * å®Œæ•´çš„ system_prompt å’Œ user_prompt_template
     * è§£æåçš„ variables_jsonï¼ˆæ•°ç»„æ ¼å¼ï¼‰
   - æ¨¡æ¿ä¸å­˜åœ¨æ—¶è¿”å› 404 é”™è¯¯

5. **æ›´æ–°æç¤ºè¯æ¨¡æ¿ API** (åç«¯æ¥å£å±‚)
   - å®ç° `PUT /api/config/prompts/:id` API æ¥å£
   - ç³»ç»Ÿé¢„ç½®æ¨¡æ¿ï¼ˆis_system=trueï¼‰ä¸å…è®¸ä¿®æ”¹ï¼Œè¿”å› 403 é”™è¯¯
   - å¯æ›´æ–°å­—æ®µï¼š
     * template_name
     * category
     * description
     * system_prompt
     * user_prompt_template
     * variables_json
     * is_activeï¼ˆå¯ç”¨/ç¦ç”¨ï¼‰
   - è‡ªåŠ¨æ›´æ–° updated_at æ—¶é—´æˆ³
   - è¿”å›æ›´æ–°åçš„å®Œæ•´æ¨¡æ¿ä¿¡æ¯

6. **åˆ é™¤æç¤ºè¯æ¨¡æ¿ API** (åç«¯æ¥å£å±‚)
   - å®ç° `DELETE /api/config/prompts/:id` API æ¥å£
   - ç³»ç»Ÿé¢„ç½®æ¨¡æ¿ï¼ˆis_system=trueï¼‰ä¸å…è®¸åˆ é™¤ï¼Œè¿”å› 403 é”™è¯¯
   - ç”¨æˆ·åˆ›å»ºçš„æ¨¡æ¿å¯ä»¥åˆ é™¤
   - åˆ é™¤æˆåŠŸè¿”å› 200 çŠ¶æ€ç 
   - æ¨¡æ¿ä¸å­˜åœ¨è¿”å› 404 é”™è¯¯

7. **å‰ç«¯åˆ—è¡¨é¡µé¢** (UI å±‚)
   - åˆ›å»ºè·¯ç”±ï¼š`/model-config/prompts`
   - ä½¿ç”¨ ProTable ç»„ä»¶å±•ç¤ºæ¨¡æ¿åˆ—è¡¨
   - è¡¨æ ¼åˆ—å®šä¹‰ï¼š
     * æ¨¡æ¿åç§°ï¼ˆ25%ï¼Œå¯æ’åºï¼Œç‚¹å‡»è·³è½¬è¯¦æƒ…ï¼‰
     * åˆ†ç±»ï¼ˆ15%ï¼Œå¯ç­›é€‰ï¼šé£é™©åˆ†æ/æˆæœ¬ä¼°ç®—/æŠ¥å‘Šç”Ÿæˆ/è‡ªå®šä¹‰ï¼‰
     * ç±»å‹ï¼ˆ10%ï¼Œæ˜¾ç¤ºï¼šç³»ç»Ÿ/ç”¨æˆ·ï¼Œå¸¦æ ‡ç­¾æ ·å¼ï¼‰
     * å˜é‡æ•°ï¼ˆ8%ï¼Œæ˜¾ç¤ºå˜é‡æ•°é‡ï¼‰
     * çŠ¶æ€ï¼ˆ10%ï¼Œæ˜¾ç¤ºï¼šå¯ç”¨/ç¦ç”¨ï¼Œå¸¦é¢œè‰²æ ‡ç­¾ï¼‰
     * åˆ›å»ºæ—¶é—´ï¼ˆ17%ï¼Œå¯æ’åºï¼‰
     * æ“ä½œï¼ˆ15%ï¼ŒåŒ…å«ï¼šæŸ¥çœ‹ã€ç¼–è¾‘ã€å¤åˆ¶ã€åˆ é™¤æŒ‰é’®ï¼‰
   - é¡¶éƒ¨å·¥å…·æ ï¼š
     * "æ–°å»ºæ¨¡æ¿"æŒ‰é’®ï¼ˆä¸»æŒ‰é’®ï¼‰
     * æ ‡ç­¾ç­›é€‰ï¼š[ğŸ“š ç³»ç»Ÿé¢„ç½®] [ğŸ‘¤ æˆ‘çš„æ¨¡æ¿]
     * æœç´¢æ¡†ï¼ˆæŒ‰åç§°æœç´¢ï¼‰
   - åˆ†é¡µï¼šæ¯é¡µ 10 æ¡è®°å½•

8. **å‰ç«¯æ–°å»º/ç¼–è¾‘è¡¨å•** (UI å±‚)
   - åˆ›å»ºè·¯ç”±ï¼š`/model-config/prompts/create` å’Œ `/model-config/prompts/:id/edit`
   - ä½¿ç”¨ ProForm ç»„ä»¶æ„å»ºè¡¨å•
   - è¡¨å•å­—æ®µï¼š
     * æ¨¡æ¿åç§°ï¼ˆå¿…å¡«ï¼Œæ–‡æœ¬è¾“å…¥æ¡†ï¼Œæœ€å¤š 100 å­—ç¬¦ï¼‰
     * åˆ†ç±»ï¼ˆå¿…å¡«ï¼Œä¸‹æ‹‰é€‰æ‹©ï¼šé£é™©åˆ†æ/æˆæœ¬ä¼°ç®—/æŠ¥å‘Šç”Ÿæˆ/è‡ªå®šä¹‰ï¼‰
     * æè¿°ï¼ˆå¯é€‰ï¼Œæ–‡æœ¬åŸŸï¼Œæœ€å¤š 500 å­—ç¬¦ï¼‰
     * ç³»ç»Ÿæç¤ºè¯ï¼ˆå¿…å¡«ï¼Œæ–‡æœ¬åŸŸï¼Œæ”¯æŒå¤šè¡Œï¼Œæ˜¾ç¤ºå­—ç¬¦è®¡æ•°ï¼‰
     * ç”¨æˆ·æç¤ºè¯æ¨¡æ¿ï¼ˆå¿…å¡«ï¼Œæ–‡æœ¬åŸŸï¼Œæ”¯æŒå¤šè¡Œï¼Œæ˜¾ç¤ºå­—ç¬¦è®¡æ•°ï¼‰
   - è¡¨å•å¸ƒå±€ï¼šåˆ†æ®µå¼ï¼Œæ¯æ®µåŒ…å«æ ‡é¢˜å’Œè¯´æ˜
   - ç³»ç»Ÿæç¤ºè¯è¯´æ˜ï¼š"å®šä¹‰ AI çš„è§’è‰²ã€ä¸“ä¸šé¢†åŸŸå’Œä»»åŠ¡ç›®æ ‡"
   - ç”¨æˆ·æç¤ºè¯è¯´æ˜ï¼š"ä½¿ç”¨ {å˜é‡å} æ ¼å¼æ’å…¥å˜é‡"
   - åº•éƒ¨æ“ä½œæŒ‰é’®ï¼š[å–æ¶ˆ] [ä¿å­˜]
   - ä¿å­˜æˆåŠŸåè¿”å›åˆ—è¡¨é¡µå¹¶æ˜¾ç¤ºæˆåŠŸæç¤º

9. **æ“ä½œæƒé™å’Œæç¤º** (äº¤äº’å±‚)
   - ç³»ç»Ÿé¢„ç½®æ¨¡æ¿ï¼š
     * ç¼–è¾‘æŒ‰é’®æ˜¾ç¤ºä¸º"æŸ¥çœ‹"ï¼ˆåªè¯»æ¨¡å¼ï¼‰
     * åˆ é™¤æŒ‰é’®ç¦ç”¨ï¼Œhover æ—¶æ˜¾ç¤ºæç¤ºï¼š"ç³»ç»Ÿé¢„ç½®æ¨¡æ¿ä¸å¯åˆ é™¤"
     * è¿›å…¥ç¼–è¾‘é¡µé¢æ—¶ï¼Œæ‰€æœ‰è¡¨å•å­—æ®µè®¾ä¸ºåªè¯»
   - ç”¨æˆ·åˆ›å»ºæ¨¡æ¿ï¼š
     * ç¼–è¾‘æŒ‰é’®æ­£å¸¸å¯ç”¨
     * åˆ é™¤æ—¶æ˜¾ç¤ºäºŒæ¬¡ç¡®è®¤ï¼š"ç¡®å®šåˆ é™¤ [æ¨¡æ¿åç§°]ï¼Ÿåˆ é™¤åæ— æ³•æ¢å¤ã€‚"
   - ç©ºçŠ¶æ€æç¤ºï¼š
     * æ— æ¨¡æ¿æ—¶æ˜¾ç¤ºï¼š"æš‚æ— æç¤ºè¯æ¨¡æ¿ï¼Œç‚¹å‡»ä¸Šæ–¹æŒ‰é’®åˆ›å»º"
</acceptanceCriteria>

  <artifacts>
    <docs>
      <doc path="docs/prd/model-config-spec.md" title="æ¨¡å‹é…ç½®åŠŸèƒ½è¯¦ç»†è§„æ ¼ (PRD)" section="1.1 åŠŸèƒ½å®šä½" snippet="ç®¡ç†æç¤ºè¯æ¨¡æ¿"/>
      <doc path="docs/prd/model-config-spec.md" title="æ¨¡å‹é…ç½®åŠŸèƒ½è¯¦ç»†è§„æ ¼ (PRD)" section="2.1 æ¨¡å—ç»“æ„" snippet="æç¤ºè¯æ¨¡æ¿ç®¡ç† (Prompt Template Management)"/>
      <doc path="docs/prd/model-config-spec.md" title="æ¨¡å‹é…ç½®åŠŸèƒ½è¯¦ç»†è§„æ ¼ (PRD)" section="2.2 è·¯ç”±è®¾è®¡" snippet="/model-config/prompts - æç¤ºè¯æ¨¡æ¿ç®¡ç†"/>
      <doc path="docs/prd/model-config-spec.md" title="æ¨¡å‹é…ç½®åŠŸèƒ½è¯¦ç»†è§„æ ¼ (PRD)" section="4. å­æ¨¡å—2: æç¤ºè¯æ¨¡æ¿ç®¡ç†" snippet="ç®¡ç†AIåŠŸèƒ½ä½¿ç”¨çš„æç¤ºè¯æ¨¡æ¿ã€‚ç³»ç»Ÿé¢„ç½®å¸¸ç”¨æ¨¡æ¿ï¼ˆå¦‚é£é™©åˆ†æã€æˆæœ¬ä¼°ç®—ï¼‰ï¼Œç”¨æˆ·ä¹Ÿå¯ä»¥åˆ›å»ºè‡ªå®šä¹‰æ¨¡æ¿ã€‚æ¨¡æ¿æ”¯æŒå˜é‡å ä½ç¬¦ï¼Œè¿è¡Œæ—¶åŠ¨æ€æ›¿æ¢ã€‚"/>
      <doc path="docs/prd/model-config-spec.md" title="æ¨¡å‹é…ç½®åŠŸèƒ½è¯¦ç»†è§„æ ¼ (PRD)" section="4.2.1 æç¤ºè¯æ¨¡æ¿åº“" snippet="æ¨¡æ¿åˆ†ç±»: é£é™©åˆ†æ, æˆæœ¬ä¼°ç®—, æŠ¥å‘Šç”Ÿæˆ, è‡ªå®šä¹‰; æ¨¡æ¿ç±»å‹: ç³»ç»Ÿé¢„ç½® (ä¸å¯åˆ é™¤ï¼Œå¯ä»¥ç¦ç”¨), ç”¨æˆ·è‡ªå®šä¹‰ (å¯ç¼–è¾‘ã€åˆ é™¤)"/>
      <doc path="docs/prd/model-config-spec.md" title="æ¨¡å‹é…ç½®åŠŸèƒ½è¯¦ç»†è§„æ ¼ (PRD)" section="4.3 æ•°æ®ç»“æ„" snippet="interface PromptTemplate { ... }"/>
      <doc path="docs/prd/model-config-spec.md" title="æ¨¡å‹é…ç½®åŠŸèƒ½è¯¦ç»†è§„æ ¼ (PRD)" section="4.4 é¡µé¢è®¾è®¡" snippet="åˆ—è¡¨é¡µé¢ and ç¼–è¾‘å™¨é¡µé¢ descriptions and mockups."/>
      <doc path="docs/prd/model-config-spec.md" title="æ¨¡å‹é…ç½®åŠŸèƒ½è¯¦ç»†è§„æ ¼ (PRD)" section="4.7 APIæ¥å£" snippet="GET /api/config/prompts, POST /api/config/prompts, PUT /api/config/prompts/:id, DELETE /api/config/prompts/:id"/>
      <doc path="docs/prd/model-config-spec.md" title="æ¨¡å‹é…ç½®åŠŸèƒ½è¯¦ç»†è§„æ ¼ (PRD)" section="5.2 è¡¨2: prompt_templates" snippet="CREATE TABLE prompt_templates (...)"/>
    </docs>
<code>
      <artifact path="server/controllers/promptTemplateController.js" kind="controller" reason="New controller for prompt templates, following existing patterns like aiModelController.js"/>
      <artifact path="server/migrations/002_create_prompt_templates.js" kind="migration" reason="New migration script for prompt_templates table, following 001_create_ai_model_configs.js"/>
      <artifact path="server/models/promptTemplateModel.js" kind="model" reason="New model for prompt templates, following existing patterns like configModel.js"/>
      <artifact path="server/routes/config.js" kind="route" reason="Existing config router to be extended for prompt template routes"/>
      <artifact path="server/services/promptTemplateService.js" kind="service" reason="New service for prompt templates, following existing patterns like projectService.js"/>
    </code>
    <dependencies>
        <dependency name="exceljs" version="^4.4.0" ecosystem="npm"/>
        <dependency name="express" version="^5.1.0" ecosystem="npm"/>
        <dependency name="pdfkit" version="^0.17.2" ecosystem="npm"/>
        <dependency name="sqlite3" version="^5.1.7" ecosystem="npm"/>
      </dependencies>
  </artifacts>

  <constraints>
    <constraint>Backend: Node.js, Express, SQLite3</constraint>
    <constraint>Frontend: React, Ant Design Pro</constraint>
    <constraint>Database migrations managed via server/migrations/</constraint>
    <constraint>API endpoints follow RESTful conventions under /api/config/</constraint>
  </constraints>
  <interfaces>
    <interface name="Prompt Template API" kind="REST endpoint" signature="GET /api/config/prompts" path="server/routes/config.js"/>
    <interface name="Prompt Template API" kind="REST endpoint" signature="POST /api/config/prompts" path="server/routes/config.js"/>
    <interface name="Prompt Template API" kind="REST endpoint" signature="GET /api/config/prompts/:id" path="server/routes/config.js"/>
    <interface name="Prompt Template API" kind="REST endpoint" signature="PUT /api/config/prompts/:id" path="server/routes/config.js"/>
    <interface name="Prompt Template API" kind="REST endpoint" signature="DELETE /api/config/prompts/:id" path="server/routes/config.js"/>
  </interfaces>
  <tests>
    <standards>The project uses Jest for backend API unit tests. Manual testing is performed for full flows. Frontend component tests are optional. Testing covers functional, simplified security, performance, and compatibility aspects.</standards>
    <locations>
      <location>server/tests/</location>
      <location>frontend/ppa_frontend/src/pages/ModelConfig/Prompts/</location>
    </locations>
    <ideas>
      <idea acId="1">Verify `prompt_templates` table and indexes are created correctly.</idea>
      <idea acId="2">Test successful creation of prompt template, and validation errors for POST /api/config/prompts.</idea>
      <idea acId="3">Test filtering, searching, sorting, and empty list display for GET /api/config/prompts.</idea>
      <idea acId="4">Test valid ID and invalid ID (404) for GET /api/config/prompts/:id.</idea>
      <idea acId="5">Test successful update, unauthorized update (system templates), and validation errors for PUT /api/config/prompts/:id.</idea>
      <idea acId="6">Test successful deletion, unauthorized deletion (system templates), and invalid ID (404) for DELETE /api/config/prompts/:id.</idea>
      <idea acId="7">Verify frontend list page displays table, filtering, search, sorting, navigation, and action buttons correctly.</idea>
      <idea acId="8">Verify frontend new/edit form fields, validation, save/cancel logic, and read-only mode for system templates.</idea>
      <idea acId="9">Verify system template restrictions, delete confirmation, and empty state display.</idea>
    </ideas>
  </tests>
</story-context>
