<story-context id="dashboard-redesign-enhancement-2" v="1.0">
  <metadata>
    <epicId>dashboard-redesign-enhancement</epicId>
    <storyId>2</storyId>
    <title>仪表板前端UI/UX实现</title>
    <status>Draft</status>
    <generatedAt>2025-11-06</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/stories/story-dashboard-redesign-enhancement-2.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>用户</asA>
    <iWant>在仪表板上直观地查看所有核心项目评估指标和数据可视化</iWant>
    <soThat>能够快速理解项目整体状况，做出更明智的决策</soThat>
    <tasks>
      - 创建或修改 `frontend/ppa_frontend/src/pages/Dashboard/` 下的 React 组件。
      - 根据新的 API 接口，更新数据请求逻辑。
      - 实现新的 UI 布局和图表展示。
      - 编写单元测试，验证 React 组件的渲染、交互和数据绑定。
      - 编写端到端测试，模拟用户访问仪表板，验证数据展示的正确性和交互的流畅性。
    </tasks>
  </story>

  <acceptanceCriteria>
    1.  仪表板页面布局符合设计稿要求。
    2.  项目总数、平均成本以统计卡片形式展示。
    3.  风险等级分布以饼图或柱状图形式展示。
    4.  成本构成分析以环形图或堆叠柱状图形式展示。
    5.  角色成本占比以饼图或堆叠柱状图形式展示。
    6.  项目成本趋势以折线图形式展示。
    7.  风险因子与成本关联以散点图或气泡图形式展示。
    8.  仪表板布局支持不同屏幕尺寸的响应式展示。
    9.  数据加载失败时显示友好的错误提示。
    10. 无数据时显示"暂无数据"状态。
    11. 仪表板页面首次加载时间在 2 秒以内。
  </acceptanceCriteria>

  <artifacts>
    <docs>
      <doc path="docs/tech-spec.md" title="PPA - 技术规范" section="设计参考, 前端重构" snippet="定义了仪表板页面布局、统计卡片、图表类型、颜色方案等UI/UX设计要求，并说明了前端重构的技术方法和目标。"/>
      <doc path="docs/tech-spec.md" title="PPA - 技术规范" section="技术细节" snippet="详细定义了所有数据指标（项目总数、平均成本、风险等级分布等）的计算方式和展示形式，以及对应的前端实现要求。"/>
      <doc path="docs/tech-spec.md" title="PPA - 技术规范" section="性能目标" snippet="明确要求仪表板页面首次加载时间应控制在 2 秒以内，并要求支持响应式设计。"/>
      <doc path="docs/epics.md" title="PPA - Epic Breakdown" section="Epic Overview" snippet="定义了仪表板内容重新设计与增强的史诗目标、范围和成功标准，强调了数据可视化和用户体验的提升。"/>
    </docs>
    <code>
      <file path="frontend/ppa_frontend/src/pages/Dashboard.tsx" kind="page component" reason="当前仪表板主页面组件，需要根据新设计进行重构和增强"/>
      <file path="frontend/ppa_frontend/src/services/dashboard/index.ts" kind="service" reason="Dashboard API服务层，需要更新以调用新的后端API接口"/>
      <file path="frontend/ppa_frontend/src/services/dashboard/typings.d.ts" kind="type definitions" reason="Dashboard相关的TypeScript类型定义"/>
      <file path="server/routes/dashboard.js" kind="API routes" reason="后端Dashboard API路由定义，提供前端所需的数据接口"/>
      <file path="server/controllers/dashboardController.js" kind="controller" reason="Dashboard API控制器，处理前端请求并返回数据"/>
      <file path="server/services/dashboardService.js" kind="service" reason="Dashboard数据聚合服务逻辑"/>
    </code>
    <dependencies>
      <dependency name="React" version="^18.0.33"/>
      <dependency name="Ant Design" version="^5.4.0"/>
      <dependency name="@ant-design/pro-components" version="^2.4.4"/>
      <dependency name="@ant-design/charts" version="^2.6.5"/>
      <dependency name="@ant-design/icons" version="^5.0.1"/>
      <dependency name="@umijs/max" version="^4.5.2"/>
      <dependency name="TypeScript" version="^5.0.3"/>
    </dependencies>
  </artifacts>

  <constraints>
    <constraint type="performance" value="仪表板页面首次加载时间应控制在 2 秒以内。"/>
    <constraint type="performance" value="所有数据 API 调用响应时间应在 500 毫秒以内（由 Story 1 保证）。"/>
    <constraint type="responsive" value="仪表板布局必须支持不同屏幕尺寸（桌面、平板）的响应式展示。"/>
    <constraint type="error_handling" value="数据加载失败时必须显示友好的错误提示（使用 Ant Design 的 Alert 组件）。"/>
    <constraint type="empty_state" value="无数据时必须显示"暂无数据"状态，不能显示空白或错误页面。"/>
    <constraint type="design" value="页面布局和图表类型必须符合设计稿要求（统计卡片、饼图、柱状图、折线图、散点图等）。"/>
    <constraint type="framework" value="必须使用 Ant Design Pro 布局组件和 @ant-design/charts 图表库。"/>
  </constraints>

  <interfaces>
    <interface name="Dashboard Summary API" kind="REST endpoint" signature="GET /api/dashboard/summary" path="server/routes/dashboard.js" description="返回项目总数和平均成本"/>
    <interface name="Risk Distribution API" kind="REST endpoint" signature="GET /api/dashboard/risk-distribution" path="server/routes/dashboard.js" description="返回风险等级分布数据"/>
    <interface name="Cost Composition API" kind="REST endpoint" signature="GET /api/dashboard/cost-composition" path="server/routes/dashboard.js" description="返回成本构成分析数据"/>
    <interface name="Role Cost Distribution API" kind="REST endpoint" signature="GET /api/dashboard/role-cost-distribution" path="server/routes/dashboard.js" description="返回角色成本占比数据"/>
    <interface name="Cost Trend API" kind="REST endpoint" signature="GET /api/dashboard/cost-trend" path="server/routes/dashboard.js" description="返回项目成本趋势数据"/>
    <interface name="Risk Cost Correlation API" kind="REST endpoint" signature="GET /api/dashboard/risk-cost-correlation" path="server/routes/dashboard.js" description="返回风险因子与成本关联数据"/>
    <interface name="PageContainer" kind="React component" signature="<PageContainer>...</PageContainer>" description="Ant Design Pro 页面容器组件"/>
    <interface name="Pie Chart" kind="React component" signature="<Pie {...config} />" description="@ant-design/charts 饼图组件"/>
    <interface name="Line Chart" kind="React component" signature="<Line {...config} />" description="@ant-design/charts 折线图组件"/>
    <interface name="Column Chart" kind="React component" signature="<Column {...config} />" description="@ant-design/charts 柱状图组件"/>
    <interface name="Scatter Chart" kind="React component" signature="<Scatter {...config} />" description="@ant-design/charts 散点图组件"/>
  </interfaces>

  <tests>
    <standards>使用 Jest 和 React Testing Library 对 React 组件进行单元测试，验证组件渲染、交互和数据绑定的正确性。使用 Cypress 或 Playwright 编写端到端测试，模拟用户访问仪表板页面，验证数据展示和交互流畅性。测试应覆盖所有验收标准，包括响应式布局、错误处理和空状态展示。</standards>
    <locations>
      <location>frontend/ppa_frontend/src/pages/Dashboard/__tests__/</location>
      <location>frontend/ppa_frontend/tests/e2e/</location>
    </locations>
    <ideas>
      <idea ac="AC1">测试页面布局结构是否符合设计要求，验证所有组件是否正确渲染。</idea>
      <idea ac="AC2,AC3,AC4,AC5,AC6,AC7">为每个图表和统计卡片编写单元测试，验证数据正确展示和图表配置。</idea>
      <idea ac="AC8">在不同视口大小下测试响应式布局是否正常工作。</idea>
      <idea ac="AC9">模拟 API 失败场景，验证错误提示是否正确显示。</idea>
      <idea ac="AC10">模拟无数据场景，验证空状态展示是否正确。</idea>
      <idea ac="AC11">使用性能测试工具测量页面首次加载时间，确保在 2 秒以内。</idea>
      <idea>编写 E2E 测试，模拟用户完整的仪表板访问流程，验证所有功能和交互。</idea>
    </ideas>
  </tests>
</story-context>
