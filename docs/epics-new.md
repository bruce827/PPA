# PPA - Epic Breakdown (重新设计)

**作者:** bruce  
**日期:** 2025-11-08  
**项目级别:** Level 2-3  
**目标规模:** 中小型SaaS产品

---

## 概述

本文档为软件项目评估系统(PPA)提供完整的Epic和用户故事分解，遵循BMad Method最佳实践，确保：
- 第一个Epic建立完整系统基础
- 每个故事都是垂直切片，提供端到端功能
- 无前向依赖，支持顺序开发
- 完整的功能需求(FR)编号和追踪系统

## Epic结构概览

**Epic 1: 系统基础建设** - 建立完整的项目评估系统基础设施
**Epic 2: 核心评估流程** - 实现完整的项目评估向导和数据管理
**Epic 3: 数据分析和可视化** - 实现Dashboard和报告功能
**Epic 4: 系统配置和模板** - 实现参数配置和模板管理功能

---

## 功能需求编号系统 (FR)

### 基础功能需求 (Core FRs)
- **FR-001**: 系统能够存储和管理项目数据
- **FR-002**: 系统能够执行实时成本计算
- **FR-003**: 系统能够提供分步式项目评估向导
- **FR-004**: 系统能够管理项目模板
- **FR-005**: 系统能够导出评估报告

### 配置管理需求 (Config FRs)  
- **FR-010**: 系统能够管理角色和单价配置
- **FR-011**: 系统能够管理风险评估项目
- **FR-012**: 系统能够管理差旅成本标准

### 数据展示需求 (Display FRs)
- **FR-020**: 系统能够展示项目概览Dashboard
- **FR-021**: 系统能够展示项目历史列表
- **FR-022**: 系统能够展示详细的项目信息

### 业务逻辑需求 (Business FRs)
- **FR-030**: 系统能够计算风险评分和评分因子
- **FR-031**: 系统能够计算工作量和成本
- **FR-032**: 系统能够处理项目模板创建和应用

---

## Epic 1: 系统基础建设

**Epic标题:** 基础评估系统建设  
**Epic目标:** 建立完整的项目评估系统基础设施，包括数据库设计、API架构、用户界面基础，为所有后续功能提供可靠的技术基础。

### Story 1.1: 项目基础架构初始化

**FR-001.1** (从FR-001分解)

作为系统开发者，我想要建立完整的基础架构，包括数据库、API基础和部署流程，以便能够可靠地支持整个项目评估系统。

**Acceptance Criteria:**

**Given** 项目有清晰的数据库需求
**When** 开发者运行数据库初始化脚本
**Then** 系统创建完整的数据库表结构（projects, config_roles, config_risk_items, config_travel_costs）

**And** 数据库支持项目数据存储、角色配置、风险配置和差旅配置

**And** 基础API路由系统建立，支持健康检查和基本功能

**Prerequisites:** 无（第一个故事）

**Technical Notes:** 
- 使用SQLite3数据库
- 创建数据表关系（projects主表，config_*配置表）
- 建立基础Express.js API架构
- 设置项目目录结构

---

### Story 1.2: 项目数据管理功能实现

**FR-001.2** (从FR-001分解)

作为系统用户，我想要能够创建、查看、编辑和删除项目，以便能够管理我的项目评估数据。

**Acceptance Criteria:**

**Given** 用户访问项目列表页面
**When** 用户点击"新建项目"按钮并填写项目信息
**Then** 系统保存项目数据并显示成功消息

**And** 用户可以查看现有项目列表，按名称排序

**And** 用户可以编辑已有项目的名称和描述

**And** 用户可以删除项目，系统会询问确认

**Prerequisites:** Story 1.1 (数据库和基础API)

**Technical Notes:**
- 实现CRUD API端点：GET /api/projects, POST /api/projects, PUT /api/projects/:id, DELETE /api/projects/:id
- 前端：使用React + Ant Design创建项目列表页面和表单
- 数据库操作：使用SQLite3进行项目数据的增删改查

---

### Story 1.3: 系统配置管理基础

**FR-010.1, FR-011.1, FR-012.1** (从配置FRs分解)

作为系统管理员，我想要能够管理基础配置项，包括角色、风险项和差旅成本，以便能够定制评估模型的参数。

**Acceptance Criteria:**

**Given** 用户进入参数配置页面
**When** 用户查看、创建、编辑配置项
**Then** 系统能够成功保存和显示配置信息

**And** 支持角色名称和单价配置（config_roles表）

**And** 支持风险评估项目和选项配置（config_risk_items表）

**And** 支持差旅成本项目配置（config_travel_costs表）

**Prerequisites:** Story 1.1 (数据库基础)

**Technical Notes:**
- 实现配置管理的CRUD API
- 前端：创建配置管理界面，支持表格展示和表单编辑
- 验证逻辑：确保配置数据的完整性和有效性

---

## Epic 2: 核心评估流程

**Epic标题:** 完整项目评估向导实现  
**Epic目标:** 实现分步式的项目评估流程，包括风险评分、工作量估算、成本计算和保存功能，提供完整的端到端评估体验。

### Story 2.1: 风险评估流程实现

**FR-003.1, FR-030** (从FR-003和FR-030分解)

作为项目评估用户，我想要完成风险评估步骤，选择风险项并看到实时计算的风险评分和评分因子，以便准确评估项目风险。

**Acceptance Criteria:**

**Given** 用户开始新项目评估
**When** 用户进入风险评估步骤
**Then** 系统显示动态生成的风险评估问卷

**And** 用户可以选择每个风险项的选项

**And** 系统实时计算并显示风险总分

**And** 系统根据风险总分计算并显示评分因子

**Prerequisites:** Story 1.3 (风险项配置基础)

**Technical Notes:**
- 从config_risk_items表动态生成评估表单
- 实时计算：风险总分 = ∑(选中选项分值)
- 评分因子计算：ratio = 风险总分 / 100
- 前端：使用Ant Design表单组件，支持动态表单生成

---

### Story 2.2: 工作量估算和成本计算

**FR-003.2, FR-031** (从FR-003和FR-031分解)

作为项目评估用户，我想要录入新功能开发和系统对接的工作量，看到实时的工时和成本计算，以便能够准确估算项目资源需求。

**Acceptance Criteria:**

**Given** 用户完成风险评估并进入工作量估算步骤
**When** 用户在可动态增删的表格中录入各角色的工作量
**Then** 系统实时计算并显示工时统计和成本构成

**And** 支持"新功能开发"和"系统对接"两个工作量类别

**And** 支持添加/删除工作量记录，按角色选择

**And** 计算公式：工作量成本 = 角色单价 × 人天数量

**And** 实时显示总计工时和总成本

**Prerequisites:** Story 2.1 (风险评估完成) + Story 1.3 (角色配置)

**Technical Notes:**
- 使用role和unit_price从config_roles表
- 支持动态表格的增删改查
- 实时计算算法：sum(role_unit_price × workload_days)
- 前端：使用Ant Design Table组件，支持行内编辑

---

### Story 2.3: 其他成本录入和最终计算

**FR-003.3, FR-031.2** (从FR-003和FR-031分解)

作为项目评估用户，我想要录入差旅、运维和风险成本，并看到最终的项目总成本，以便获得完整的项目报价。

**Acceptance Criteria:**

**Given** 用户完成工作量估算
**When** 用户录入差旅、运维和其他风险成本
**Then** 系统计算并显示所有成本构成的详细总览

**And** 差旅成本：月度差旅成本 × 项目月数

**And** 运维成本：运维人天 × 运维角色单价

**And** 风险成本：用户自定义的风险成本项目

**And** 总成本 = 软件开发成本 + 系统对接成本 + 差旅成本 + 运维成本 + 风险成本

**And** 显示成本构成饼图和详细明细

**Prerequisites:** Story 2.2 (工作量估算)

**Technical Notes:**
- 集成差旅成本配置（config_travel_costs）
- 成本聚合算法
- 前端：使用图表组件展示成本构成
- 保存完整评估数据到assessment_details_json字段

---

### Story 2.4: 评估保存和模板功能

**FR-004** (从FR-004分解)

作为项目评估用户，我想要保存完成的评估，可以选择保存为项目或保存为模板，以便将来复用和对比。

**Acceptance Criteria:**

**Given** 用户完成所有评估步骤
**When** 用户点击"保存评估"按钮
**Then** 系统保存评估数据并询问保存类型

**And** 用户可以保存为"项目"（带项目名称）

**And** 用户可以勾选"另存为模板"保存为模板

**And** 系统显示保存成功消息并跳转到相应列表页面

**And** 保存的数据包括：评估详情JSON、项目信息、最终成本等

**Prerequisites:** Story 2.3 (其他成本录入)

**Technical Notes:**
- 使用is_template字段区分项目和模板
- 保存完整的assessment_details_json
- 前端：保存成功后的页面跳转逻辑

---

## Epic 3: 数据分析和可视化

**Epic标题:** 数据可视化和历史管理  
**Epic目标:** 实现项目数据的可视化展示和历史管理功能，让用户能够直观地了解项目成本、风险分布和历史趋势。

### Story 3.1: 历史项目列表功能

**FR-022, FR-021** (从FR-021和FR-022分解)

作为系统用户，我想要查看所有已完成的项目列表，能够搜索、排序和查看项目详情，以便管理我的项目历史。

**Acceptance Criteria:**

**Given** 用户进入历史项目页面
**When** 系统加载项目列表并显示
**Then** 用户可以看到所有非模板项目的列表

**And** 支持按项目名称搜索

**And** 支持按成本、风险分数、创建时间排序

**And** 每行显示：项目名称、最终成本、风险分数、创建时间

**And** 支持"查看详情"、"编辑"、"删除"操作

**Prerequisites:** Story 1.2 (项目基础管理)

**Technical Notes:**
- 查询非模板项目（is_template = false）
- 前端：Ant Design Table组件，支持搜索、排序、操按钮
- API：GET /api/projects?template=false

---

### Story 3.2: 项目详情和报告导出

**FR-005** (从FR-005分解)

作为项目用户，我想要查看项目的详细评估信息，并且能够导出PDF或Excel报告，以便进行项目汇报和分析。

**Acceptance Criteria:**

**Given** 用户点击项目的"查看详情"按钮
**When** 系统显示项目详情页面
**Then** 用户可以看到完整的评估信息

**And** 显示风险评分和评分因子

**And** 显示工作量构成和成本明细

**And** 显示总成本和成本构成图表

**And** 支持"导出PDF"和"导出Excel"功能

**And** 导出的报告包含完整的评估信息

**Prerequisites:** Story 2.4 (评估保存)

**Technical Notes:**
- 解析assessment_details_json并展示
- PDF导出：使用pdfkit库
- Excel导出：使用exceljs库
- 前端：使用图表组件展示数据

---

### Story 3.3: Dashboard数据可视化

**FR-020** (从FR-020分解)

作为系统用户，我想要在首页看到项目概览Dashboard，包括项目总数、平均成本、风险分布等统计信息，以便快速了解整体情况。

**Acceptance Criteria:**

**Given** 用户访问系统首页
**When** 系统加载Dashboard
**Then** 用户看到项目统计概览

**And** 显示项目总数、总成本、平均成本

**And** 显示风险等级分布（低、中、高风险）

**And** 显示成本构成比例（开发、集成、差旅、运维、风险）

**And** 显示角色工作量分布

**And** 页面加载时间 < 2秒

**Prerequisites:** Story 1.2 (项目数据基础)

**Technical Notes:**
- 后端：数据聚合API，统计所有项目数据
- 前端：使用Ant Design统计卡片和图表组件
- 性能优化：缓存统计数据，实时刷新

---

## Epic 4: 系统配置和模板管理

**Epic标题:** 高级配置和模板管理  
**Epic目标:** 实现完整的模板管理系统和高级配置功能，提升评估效率和管理能力。

### Story 4.1: 模板管理和应用

**FR-004.2** (从FR-004分解)

作为系统用户，我想要管理评估模板，可以创建、编辑、删除模板，并能够从模板快速创建新评估，以便提高评估效率。

**Acceptance Criteria:**

**Given** 用户进入模板管理页面
**When** 用户查看、创建、编辑模板
**Then** 系统能够管理模板的完整生命周期

**And** 显示所有模板列表（is_template = true）

**And** 支持创建新模板（从已有项目）

**And** 支持编辑模板名称和描述

**And** 支持从模板创建新评估的快捷入口

**And** 用户可以在新建评估时选择模板进行预填充

**Prerequisites:** Story 1.2 (项目基础管理)

**Technical Notes:**
- 模板查询：GET /api/templates（使用projects表，is_template=true）
- 从模板创建：复制评估详情JSON到新项目
- 前端：模板列表页面和新建评估时的模板选择

---

### Story 4.2: 配置数据聚合和优化

**FR-010.2, FR-011.2, FR-012.2** (从配置FRs分解)

作为系统用户，我想要一次性加载所有配置信息，系统能够提供配置聚合API和前端优化，以便提高页面加载性能。

**Acceptance Criteria:**

**Given** 用户开始新的评估流程
**When** 系统需要加载配置信息
**Then** 系统提供聚合的配置信息

**And** 一个API调用返回所有角色配置信息

**And** 一个API调用返回所有风险项目配置信息

**And** 一个API调用返回所有差旅成本配置信息

**And** 前端缓存配置信息，避免重复请求

**And** 配置变更时前端自动更新缓存

**Prerequisites:** Story 1.3 (基础配置管理)

**Technical Notes:**
- API：GET /api/config/all 聚合所有配置
- 前端：React Context或Redux管理配置状态
- 缓存策略：本地存储 + 实时更新

---

## Story 验收标准统一模板

所有故事都遵循统一的验收标准格式：

**故事模式:**
```
作为 [用户类型]，
我想要 [具体能力]，
以便 [明确价值/好处]。
```

**BDD验收标准:**
```
Given [前提条件或初始状态]
When [操作或触发]
Then [预期结果]

And [额外标准]
```

**依赖关系:** 只依赖前序故事（无前向依赖）

**技术指导:** 包含实现建议、受影响组件、合规要求

---

## Epic序列和时间估算

| Epic | 故事数量 | 故事点 | 预计时间 | 主要产出 |
|------|----------|---------|----------|----------|
| Epic 1: 基础建设 | 3个故事 | 9点 | 1-2周 | 完整基础设施 |
| Epic 2: 核心评估 | 4个故事 | 12点 | 2-3周 | 评估完整流程 |
| Epic 3: 数据可视化 | 3个故事 | 9点 | 1-2周 | Dashboard和报告 |
| Epic 4: 配置模板 | 2个故事 | 6点 | 1周 | 模板和配置优化 |
| **总计** | **12个故事** | **36点** | **5-8周** | **完整PPA系统** |

---

## 下一步行动

1. **继续使用 `create-story` workflow** 生成每个故事的实现计划
2. **确保所有FR都得到覆盖** - 验证功能完整性
3. **开始架构工作流** - 技术设计和系统架构
4. **开始实施计划** - 分配故事给开发团队

---

_本Epic分解遵循BMad Method最佳实践，确保：_
- _Epic 1建立完整系统基础_
- _所有故事都是垂直切片_
- _无前向依赖，支持顺序开发_
- _完整的功能需求追踪_