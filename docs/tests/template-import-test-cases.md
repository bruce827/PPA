# 从模板导入功能 - 测试用例

## 测试环境准备

### 1. 启动后端服务
```bash
cd server
node index.js
```

### 2. 启动前端服务
```bash
cd frontend/ppa_frontend
npm run dev
```

### 3. 确保数据库中有测试数据
```bash
cd server
node init-db.js
```

## 测试用例

### TC001: 基础导入功能测试

**前置条件**：
- 系统中至少有 1 个已保存的历史项目
- 用户在"新建评估"页面

**测试步骤**：
1. 访问 `http://localhost:8000/assessment/new`
2. 点击页面顶部的"从模板导入"按钮
3. 在弹出的模态框中查看项目列表
4. 选择任意一个项目，点击"导入"按钮
5. 观察弹窗关闭，页面显示成功提示
6. 检查表单是否填充了导入的数据

**预期结果**：
- ✅ 弹窗正常打开，显示项目列表
- ✅ 项目列表包含：名称、描述、类型、风险得分、总成本、创建时间
- ✅ 点击导入后弹窗关闭
- ✅ 显示成功消息："已从项目"XXX"导入数据"
- ✅ 表单自动填充数据
- ✅ 顶部统计数据自动更新

---

### TC002: 编辑模式过滤测试

**前置条件**：
- 系统中至少有 2 个已保存的项目
- 用户在编辑某个项目

**测试步骤**：
1. 访问 `http://localhost:8000/assessment/new?edit_id=1` (假设编辑 ID 为 1 的项目)
2. 点击"从模板导入"按钮
3. 查看模板列表中是否包含 ID 为 1 的项目

**预期结果**：
- ✅ 模板列表中不显示当前正在编辑的项目（ID=1）
- ✅ 其他项目正常显示

---

### TC003: 空项目列表测试

**前置条件**：
- 数据库中没有任何历史项目

**测试步骤**：
1. 清空数据库中的项目数据
2. 访问新建评估页面
3. 点击"从模板导入"按钮

**预期结果**：
- ✅ 弹窗正常打开
- ✅ 表格显示"暂无数据"或空状态
- ✅ 没有报错

---

### TC004: 数据完整性测试

**前置条件**：
- 系统中有一个包含完整评估数据的项目

**测试步骤**：
1. 访问新建评估页面
2. 从模板导入一个完整的项目
3. 依次检查各个步骤的数据：
   - 步骤1: 风险评分
   - 步骤2: 工作量估算（新功能开发 + 系统对接）
   - 步骤3: 其他成本（差旅、运维）
   - 步骤4: 生成总览

**预期结果**：
- ✅ 风险评分数据正确填充
- ✅ 新功能开发工作量列表完整
- ✅ 系统对接工作量列表完整
- ✅ 差旅月数、人数正确
- ✅ 运维月数、人数、日成本正确
- ✅ 风险项清单完整

---

### TC005: 异常数据容错测试

**前置条件**：
- 手动在数据库中创建一个包含异常 JSON 数据的项目

**测试步骤**：
1. 在数据库中插入一条 `assessment_details_json` 为无效 JSON 的项目
2. 尝试导入该项目
3. 观察系统行为

**预期结果**：
- ✅ 显示错误提示："导入模板数据失败"
- ✅ 不会导致页面崩溃
- ✅ 其他功能继续可用

---

### TC006: 响应式布局测试

**测试步骤**：
1. 在不同设备尺寸下打开新建评估页面：
   - 桌面端 (1920x1080)
   - 平板端 (768x1024)
   - 移动端 (375x667)
2. 点击"从模板导入"按钮
3. 检查弹窗和表格的显示效果

**预期结果**：
- ✅ 桌面端：按钮在右侧，表格完整显示
- ✅ 平板端：布局自适应，表格可横向滚动
- ✅ 移动端：按钮在下方，表格支持触摸滚动

---

### TC007: 模板类型标识测试

**前置条件**：
- 数据库中既有模板项目 (is_template=1) 也有普通项目 (is_template=0)

**测试步骤**：
1. 打开模板选择弹窗
2. 检查"是否模板"列的显示

**预期结果**：
- ✅ 模板项目显示蓝色"模板"标签
- ✅ 普通项目显示灰色"项目"标签
- ✅ 标签清晰可辨

---

### TC008: 分页功能测试

**前置条件**：
- 数据库中有超过 10 个项目

**测试步骤**：
1. 打开模板选择弹窗
2. 检查分页器
3. 切换到第 2 页
4. 修改每页显示数量

**预期结果**：
- ✅ 默认显示 10 条记录
- ✅ 显示总记录数："共 XX 个项目"
- ✅ 分页器正常工作
- ✅ 可修改每页显示数量

---

### TC009: 数据覆盖测试

**测试步骤**：
1. 在新建评估页面手动填写一些数据
2. 点击"从模板导入"
3. 选择一个项目导入
4. 检查之前填写的数据是否被覆盖

**预期结果**：
- ✅ 导入操作会完全覆盖之前填写的数据
- ✅ 新数据与模板项目一致
- ⚠️  **注意**：当前版本没有导入前确认，可能误操作（已列入后续优化）

---

### TC010: 网络异常处理

**测试步骤**：
1. 断开网络连接或停止后端服务
2. 点击"从模板导入"按钮
3. 观察系统行为

**预期结果**：
- ✅ 显示错误提示："加载项目列表失败"
- ✅ 弹窗保持打开状态（或自动关闭）
- ✅ 不会导致页面崩溃

---

## 性能测试

### PT001: 大数据量加载

**测试场景**：数据库中有 100+ 个项目

**观察指标**：
- 弹窗打开速度
- 列表渲染性能
- 分页切换流畅度
- 搜索响应速度（如果实现）

**性能标准**：
- 弹窗打开 < 500ms
- 列表渲染 < 1s
- 分页切换 < 300ms

---

## 兼容性测试

### 浏览器兼容性
- ✅ Chrome (最新版)
- ✅ Firefox (最新版)
- ✅ Safari (最新版)
- ✅ Edge (最新版)

### 操作系统兼容性
- ✅ Windows 10/11
- ✅ macOS (Big Sur+)
- ✅ iOS (14+)
- ✅ Android (9+)

---

## 测试数据准备脚本

```javascript
// 在 server 目录下创建 test-data.js
const sqlite3 = require('sqlite3').verbose();
const db = new sqlite3.Database('./ppa.db');

const testProjects = [
  {
    name: '电商平台开发项目',
    description: '包含用户管理、商品管理、订单系统等模块',
    is_template: 0,
    assessment_details_json: JSON.stringify({
      risk_scores: { '项目规模': 8, '技术复杂度': 7 },
      development_workload: [
        { id: '1', module1: '用户模块', workload: 20, '前端开发': 10, '后端开发': 10 }
      ],
      integration_workload: [],
      travel_months: 2,
      travel_headcount: 2,
      maintenance_months: 12,
      maintenance_headcount: 2,
      maintenance_daily_cost: 1600,
      risk_items: []
    })
  },
  {
    name: '标准Web应用模板',
    description: '标准的企业级Web应用模板，包含基础CRUD功能',
    is_template: 1,
    assessment_details_json: JSON.stringify({
      risk_scores: { '项目规模': 5, '技术复杂度': 5 },
      development_workload: [
        { id: '1', module1: '基础模块', workload: 10, '前端开发': 5, '后端开发': 5 }
      ],
      integration_workload: [],
      travel_months: 1,
      travel_headcount: 1,
      maintenance_months: 6,
      maintenance_headcount: 1,
      maintenance_daily_cost: 1600,
      risk_items: []
    })
  }
];

// 插入测试数据
testProjects.forEach(project => {
  db.run(
    `INSERT INTO projects (name, description, is_template, final_total_cost, final_risk_score, final_workload_days, assessment_details_json)
     VALUES (?, ?, ?, ?, ?, ?, ?)`,
    [
      project.name,
      project.description,
      project.is_template,
      500000, // 模拟总成本
      75, // 模拟风险得分
      100, // 模拟工作量天数
      project.assessment_details_json
    ],
    (err) => {
      if (err) console.error(err);
      else console.log(`插入项目: ${project.name}`);
    }
  );
});

db.close();
```

运行脚本：
```bash
cd server
node test-data.js
```

---

## 测试报告模板

```markdown
### 测试执行日期：YYYY-MM-DD
### 测试人员：XXX
### 测试版本：v1.0

| 用例编号 | 用例名称 | 测试结果 | 备注 |
|---------|---------|---------|------|
| TC001   | 基础导入功能测试 | ✅ 通过 |  |
| TC002   | 编辑模式过滤测试 | ✅ 通过 |  |
| TC003   | 空项目列表测试 | ✅ 通过 |  |
| TC004   | 数据完整性测试 | ✅ 通过 |  |
| TC005   | 异常数据容错测试 | ✅ 通过 |  |
| TC006   | 响应式布局测试 | ✅ 通过 |  |
| TC007   | 模板类型标识测试 | ✅ 通过 |  |
| TC008   | 分页功能测试 | ✅ 通过 |  |
| TC009   | 数据覆盖测试 | ⚠️  需优化 | 建议添加确认提示 |
| TC010   | 网络异常处理 | ✅ 通过 |  |

**总结**：
- 通过率：90%
- 发现问题：1 个（数据覆盖无确认提示）
- 建议：添加导入前确认弹窗

**截图**：
[附上关键功能截图]
```

---

**文档版本**: v1.0  
**最后更新**: 2025-10-22
