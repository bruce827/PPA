# Web3D 项目评估模块 PRD (V1.1.0)

## 1. 概述

### 1.1 版本信息
- **版本号**: V1.1.0
- **创建日期**: 2025-12-01
- **状态**: 待评审

### 1.2 背景与目标

Web3D 项目与传统 SaaS 项目在技术栈、风险因素和工作量估算维度上存在显著差异。传统项目评估模块无法准确评估 Web3D 项目的特有风险（如模型数据资产、渲染性能、Shader 开发等）。

本版本新增 **Web3D 项目评估** 模块，专门用于评估 Three.js/Cesium 等 Web 三维可视化项目的工作量和成本。

### 1.3 核心目标

1. 提供专业化的 Web3D 项目风险评估维度
2. 支持 Web3D 特有的工作量计算公式
3. 识别数据资产风险（最大的坑点）
4. 输出准确的工作量估算和成本报价

---

## 2. 模块架构

### 2.1 菜单结构

```
├── 项目评估（现有，不动）
│   ├── 新建评估
│   └── 历史项目
├── Web3D 项目评估（新增）
│   ├── 新建评估
│   └── 历史项目
└── 配置管理
    ├── 风险配置（现有，不动）
    ├── 角色配置（现有，可复用）
    └── Web3D 风险评估（新增独立 Sheet 页）  ← 独立管理，不影响现有风险配置
```

### 2.2 技术架构复用分析

| 组件 | 复用情况 | 说明 |
|------|----------|------|
| 角色配置 | ✅ 完全复用 | 人日单价配置通用 |
| 风险配置 | ✅ 保持不动 | 现有配置页面完全不变 |
| Web3D 风险评估 | 🆕 新增独立页面 | 独立 Sheet 页，单独管理 Web3D 风险项 |
| 历史项目管理 | ✅ 框架复用 | 数据表需区分项目类型 |
| 评估流程组件 | ⚠️ 需定制 | 分步流程框架复用，内容重写 |
| Overview/导出 | ✅ 大部分复用 | 报价计算逻辑可复用 |

---

## 3. 新建评估模块

### 3.1 评估流程设计（分步 Steps）

```
Step 1: 项目背景与技术选型
    ↓
Step 2: 数据资产现状评估 ⚠️ 核心风险源
    ↓
Step 3: 开发需求评估（视觉渲染 + 交互逻辑 + 性能要求）
    ↓
Step 4: 工作量估算
    ↓
Step 5: 生成总览与报价
```

### 3.2 Step 1: 项目背景与技术选型

**目的**: 界定技术路线选型及场景规模。

#### 3.2.1 技术路线选择

| 技术路线 | 适用场景 | 优势 | 劣势 |
|----------|----------|------|------|
| **Three.js** | 园区/建筑/室内/产品展示 | 灵活、生态丰富、与前端框架集成好、包体小 | 需手写交互逻辑、GIS 能力弱 |
| **Cesium** | 城市级/大地图/GIS 应用 | 原生 GIS 坐标系、3D Tiles 支持、地球级渲染 | 学习曲线陡、定制成本高 |
| **Unity WebGL** | 游戏/元宇宙/复杂物理仿真 | 强大编辑器、物理引擎、光影效果好 | 包体大(10-50MB+)、加载慢、与 Web 交互困难 |
| **Unreal Pixel Streaming** | 极致画质/大型仿真 | 顶级渲染质量、支持光追 | 需要服务器集群、带宽成本高、延迟问题 |
| **Babylon.js** | 产品展示/轻量级交互 | 官方维护、TS 友好、PBR 渲染好 | 生态不如 Three.js 丰富 |

#### 3.2.2 场景与业务评估

| 评估维度 | 关键检查项 | 选项 | 风险/工作量影响 |
|----------|------------|------|-----------------|
| 技术路线 | 核心技术选型 | • Three.js（推荐）<br>• Cesium<br>• Unity WebGL<br>• Unreal Pixel Streaming<br>• Babylon.js<br>• 混合方案（如 Cesium + Three.js） | **混合方案**最难，需处理坐标系转换和双引擎切换 |
| 场景类型 | 宏观 vs 微观 | • 城市级/大地图 (GIS)<br>• 园区/单体建筑 (BIM)<br>• 室内/楼层<br>• 单一产品展示 | **GIS** 建议 Cesium；**BIM/室内** 建议 Three.js |
| 业务目标 | 核心用途 | • 炫酷大屏 (重视觉)<br>• 业务管理 (重数据交互)<br>• 营销展示 (重加载速度)<br>• 培训仿真 (重交互逻辑) | **大屏**吃显卡；**营销**需极致压缩；**仿真**考虑 Unity |
| 部署环境 | 硬件与终端 | • PC 浏览器<br>• 移动端 (H5/小程序)<br>• 展厅大屏 (分辨率?)<br>• 混合部署 | **移动端**限制极多（内存 <2G），必须大幅减面；**Unity WebGL 不支持移动端** |

#### 3.2.3 技术选型建议逻辑

```
IF 场景类型 == "城市级/大地图" THEN
    推荐 Cesium
ELSE IF 业务目标 == "培训仿真" AND 需要复杂物理 THEN
    推荐 Unity WebGL
ELSE IF 追求极致画质 AND 有服务器预算 THEN
    推荐 Unreal Pixel Streaming
ELSE
    推荐 Three.js（默认选择）
END

IF 部署环境包含"移动端" THEN
    排除 Unity WebGL、Unreal Pixel Streaming
    标记高风险，模型面数必须 < 50万
END

IF 技术路线 == "混合方案" THEN
    风险系数 += 0.3
    工期 += 30%
END
```

### 3.3 Step 2: 数据资产现状评估 ⚠️

**目的**: 这是 Web3D 项目最大的坑。没有模型或模型不可用，工期会增加 50%-200%。

| 评估维度 | 关键检查项 | 选项 | 风险等级 |
|----------|------------|------|----------|
| 是否有模型 | 数据源状况 | • 有现成模型<br>• 只有 CAD/图纸<br>• 只有照片/视频<br>• 啥也没有，需凭空想象 | **无模型**: 🔥极高风险，需预估建模工时（或外包）<br>**只有照片**: 涉及倾斜摄影或手工建模 |
| BIM 数据 | 格式与软件 | • Revit (.rvt)<br>• IFC<br>• Navisworks (.nwd) | **Revit**: 最常见，需专门插件导出<br>**IFC**: 通用但易丢材质 |
| 非 BIM 数据 | 格式 | • MAX/FBX/OBJ (建模软件)<br>• OSGB/CC (倾斜摄影)<br>• XYZ/LAS (点云) | **OSGB**: 必须转 3D Tiles 才能进 Web<br>**MAX**: 往往面数极高，不可直接用 |
| 数据质量 | 轻量化程度 | • 已做过轻量化<br>• 原始设计稿 (未处理) | **原始稿**: 🔥极高风险。Revit 原文件直接进 Web 必卡死，需预留大量清洗时间 |
| 数据语义 | 构件拆分 | • 已拆分单体 (点击椅子是独立的)<br>• 是一整坨 Mesh (无法选中单体) | **无法拆分**: 意味着无法做"点击高亮"、"查看属性"功能 |

### 3.4 Step 3: 开发需求评估

**目的**: 综合评估视觉渲染、交互逻辑和性能要求。

#### 3.4.1 视觉与渲染要求

| 评估维度 | 关键检查项 | 选项 | 技术难点 |
|----------|------------|------|----------|
| 美术风格 | 期望效果 | • 写实风 (PBR 材质)<br>• 科技风 (线框/全息/发光)<br>• 极简风 (AO 白模) | **写实风**: 依赖高质量贴图和光照，包体大<br>**科技风**: 依赖 Shader 编写 |
| 光影特效 | 后期处理 | • 无特效<br>• 简单泛光 (Bloom)<br>• 动态阴影<br>• 天气系统 (雨雪) | 开启特效会显著降低帧率 (FPS) |
| 动画需求 | 动态表现 | • 无动画<br>• 漫游动画 (相机动)<br>• 构件动画 (门开关、拆解)<br>• 粒子效果 (水流、火焰) | 骨骼动画或变形动画需在建模阶段做好 |

#### 3.4.2 交互与业务逻辑

| 评估维度 | 关键检查项 | 功能描述 | 复杂度 |
|----------|------------|----------|--------|
| 基础交互 | 鼠标操作 | • 旋转/缩放/平移<br>• 限制视角范围<br>• 第一人称/第三人称切换 | **低**。Three.js 自带控件可配置 |
| 选中与反馈 | Raycaster | • 无需选中<br>• 悬停/点击高亮<br>• 多选/框选 | **中**。需处理层级遮挡和性能问题 |
| 业务挂载 | 3D + UI | • 无需联动<br>• 点击模型弹窗<br>• 3D 标签跟随<br>• 列表与模型联动 | **中**。涉及 Vue/React 与 Three.js 坐标转换 |
| 复杂功能 | 高级逻辑 | • 无<br>• 测量工具 (测距/测面)<br>• 剖切 (Section Box)<br>• 路径规划/导航 | **高**。涉及较多数学计算和图形学算法 |

#### 3.4.3 性能基准线

**目的**: 提前与客户约定"卡顿"的定义，避免扯皮。

| 指标 | PC端建议基准 | 移动端建议基准 | 备注 |
|------|--------------|----------------|------|
| FPS (帧率) | > 30 (及格), > 50 (流畅) | > 30 | 低于 30 会感觉明显卡顿 |
| 首屏加载时间 | < 5秒 (理想), < 15秒 (可接受) | < 10秒 | 取决于模型压缩率和网络带宽 |
| DrawCalls | < 1000 | < 200 | 越低越好，通过合并网格优化 |
| 三角面数 (Triangles) | < 200万 | < 50万 | 硬件的硬指标 |

### 3.5 Step 4: 工作量估算

**工作量评估公式**: 

```
总工时（人天）= (A + B + C) × D
```

#### A. 数据处理 (最难预估)
| 情况 | 估算工时 |
|------|----------|
| 现成 glTF/GLB | 0.5 天 |
| 原始 Revit/BIM 模型 | 3 ~ 5 天/每栋 (含清洗、减面、转换、贴图修复) |
| 无模型需建模 | 视复杂度，每 1000 平米 2~5 天 |

#### B. 核心开发 (搭建 + 渲染)
| 内容 | 估算工时 |
|------|----------|
| 场景搭建 + 基础交互 | 3 天 |
| UI 联调 (Vue/React) | 2 天 |
| 特殊 Shader/特效 | 2 天/每个效果 |

#### C. 业务逻辑
| 内容 | 估算工时 |
|------|----------|
| 简单点击弹窗 | 1 天 |
| 复杂图表联动/数据对接 | 3~5 天 |

#### D. 风险系数
| 情况 | 系数 |
|------|------|
| 数据规范且沟通顺畅 | 1.0 |
| 数据杂乱或移动端适配 | 1.5 |
| 需求模糊且追求"极度写实" | 2.0 |
| 混合技术方案（如 Cesium + Three.js） | 额外 +0.3 |

### 3.6 Step 5: 生成总览与报价

复用现有 Overview 组件的框架，展示：
- 风险评分汇总及风险等级
- 工作量估算明细（按 A/B/C/D 分类）
- 成本计算（人日单价 × 工时 × 风险系数）
- 支持导出 Excel/PDF

---

## 4. 历史项目模块

复用现有"历史项目"模块的逻辑，主要调整：

1. **项目列表过滤**: 新增 `project_type` 字段区分普通项目和 Web3D 项目
2. **详情展示**: 适配 Web3D 评估维度的展示
3. **重新评估**: 跳转到 Web3D 新建评估页面，预填充数据

---

## 5. 配置管理扩展

### 5.1 复用现有配置（不动）

| 配置项 | 复用方式 |
|--------|----------|
| 风险配置页面 | **完全不动**，现有页面保持原样 |
| 角色配置 (roles) | 完全复用，人日单价对 Web3D 同样适用 |
| 模型配置 | 复用 AI 评估相关配置 |

### 5.2 新增 Web3D 风险评估 Sheet 页

在配置管理下新增独立的 **Web3D 风险评估** 页面（Sheet 页），与现有风险配置完全独立，互不影响。

**页面路径**: `/config/web3d-risk`
**菜单位置**: 配置管理 → Web3D 风险评估

```javascript
// 配置结构示例
{
  risk_items: [
    // Step 1: 项目背景与技术选型
    {
      step_order: 1,
      step_name: "项目背景与技术选型",
      item_name: "技术路线",
      description: "核心技术选型",
      weight: 2.0,
      options_json: [
        { label: "Three.js（推荐）", value: 1 },
        { label: "Babylon.js", value: 2 },
        { label: "Cesium", value: 3 },
        { label: "Unity WebGL", value: 4 },
        { label: "Unreal Pixel Streaming", value: 5 },
        { label: "混合方案", value: 6 }
      ]
    },
    {
      step_order: 1,
      step_name: "项目背景与技术选型",
      item_name: "场景类型",
      description: "宏观 vs 微观",
      weight: 1.0,
      options_json: [
        { label: "单一产品展示", value: 1 },
        { label: "室内/楼层", value: 2 },
        { label: "园区/单体建筑 (BIM)", value: 3 },
        { label: "城市级/大地图 (GIS)", value: 4 }
      ]
    },
    {
      step_order: 1,
      step_name: "项目背景与技术选型",
      item_name: "业务目标",
      description: "核心用途",
      weight: 1.0,
      options_json: [
        { label: "营销展示 (重加载速度)", value: 2 },
        { label: "业务管理 (重数据交互)", value: 3 },
        { label: "炫酷大屏 (重视觉)", value: 4 },
        { label: "培训仿真 (重交互逻辑)", value: 4 }
      ]
    },
    {
      step_order: 1,
      step_name: "项目背景与技术选型",
      item_name: "部署环境",
      description: "硬件与终端",
      weight: 1.5,
      options_json: [
        { label: "PC 浏览器", value: 1 },
        { label: "展厅大屏", value: 2 },
        { label: "移动端 (H5/小程序)", value: 5 },
        { label: "混合部署", value: 4 }
      ]
    },
    // Step 2: 数据资产现状
    {
      step_order: 2,
      step_name: "数据资产现状",
      item_name: "数据源状况",
      description: "是否有现成模型",
      weight: 3.0, // 权重最高，影响最大
      options_json: [
        { label: "有现成 glTF/GLB 模型", value: 1 },
        { label: "有 Revit/IFC 等 BIM 模型", value: 3 },
        { label: "只有 CAD/图纸", value: 4 },
        { label: "只有照片/视频", value: 5 },
        { label: "啥也没有，需凭空想象", value: 6 }
      ]
    },
    {
      step_order: 2,
      step_name: "数据资产现状",
      item_name: "数据质量",
      description: "轻量化程度",
      weight: 2.5,
      options_json: [
        { label: "已做过轻量化", value: 1 },
        { label: "原始设计稿 (未处理)", value: 5 }
      ]
    },
    {
      step_order: 2,
      step_name: "数据资产现状",
      item_name: "数据语义",
      description: "构件拆分情况",
      weight: 2.0,
      options_json: [
        { label: "已拆分单体", value: 1 },
        { label: "是一整坨 Mesh", value: 4 }
      ]
    },
    // Step 3: 开发需求评估（合并视觉、交互、性能）
    // === 视觉与渲染 ===
    {
      step_order: 3,
      step_name: "开发需求评估",
      item_name: "美术风格",
      description: "期望的渲染效果",
      weight: 1.5,
      options_json: [
        { label: "极简风 (AO 白模)", value: 1 },
        { label: "科技风 (线框/全息/发光)", value: 3 },
        { label: "写实风 (PBR 材质)", value: 4 }
      ]
    },
    {
      step_order: 3,
      step_name: "开发需求评估",
      item_name: "光影特效",
      description: "后期处理需求",
      weight: 1.5,
      options_json: [
        { label: "无特效", value: 1 },
        { label: "简单泛光 (Bloom)", value: 2 },
        { label: "动态阴影", value: 3 },
        { label: "天气系统 (雨雪)", value: 5 }
      ]
    },
    {
      step_order: 3,
      step_name: "开发需求评估",
      item_name: "动画需求",
      description: "动态表现",
      weight: 1.5,
      options_json: [
        { label: "无动画", value: 1 },
        { label: "漫游动画 (相机动)", value: 2 },
        { label: "构件动画 (门开关、拆解)", value: 3 },
        { label: "粒子效果 (水流、火焰)", value: 5 }
      ]
    },
    // === 交互与业务逻辑 ===
    {
      step_order: 3,
      step_name: "开发需求评估",
      item_name: "基础交互",
      description: "鼠标操作",
      weight: 1.0,
      options_json: [
        { label: "仅旋转/缩放/平移", value: 1 },
        { label: "限制视角范围", value: 2 },
        { label: "第一人称/第三人称切换", value: 3 }
      ]
    },
    {
      step_order: 3,
      step_name: "开发需求评估",
      item_name: "选中与反馈",
      description: "Raycaster 交互",
      weight: 1.5,
      options_json: [
        { label: "无需选中", value: 1 },
        { label: "悬停/点击高亮", value: 2 },
        { label: "多选/框选", value: 4 }
      ]
    },
    {
      step_order: 3,
      step_name: "开发需求评估",
      item_name: "业务挂载",
      description: "3D + UI 联动",
      weight: 2.0,
      options_json: [
        { label: "无需联动", value: 1 },
        { label: "点击模型弹窗", value: 2 },
        { label: "3D 标签跟随", value: 3 },
        { label: "列表与模型联动", value: 4 }
      ]
    },
    {
      step_order: 3,
      step_name: "开发需求评估",
      item_name: "复杂功能",
      description: "高级逻辑",
      weight: 2.5,
      options_json: [
        { label: "无", value: 1 },
        { label: "测量工具 (测距/测面)", value: 3 },
        { label: "剖切 (Section Box)", value: 4 },
        { label: "路径规划/导航", value: 5 }
      ]
    },
    // === 性能要求 ===
    {
      step_order: 3,
      step_name: "开发需求评估",
      item_name: "目标 FPS",
      description: "帧率要求",
      weight: 1.0,
      options_json: [
        { label: "> 30 (及格)", value: 1 },
        { label: "> 50 (流畅)", value: 2 },
        { label: "> 60 (极致)", value: 4 }
      ]
    },
    {
      step_order: 3,
      step_name: "开发需求评估",
      item_name: "首屏加载时间",
      description: "加载速度要求",
      weight: 1.5,
      options_json: [
        { label: "< 15秒 (可接受)", value: 1 },
        { label: "< 5秒 (理想)", value: 3 },
        { label: "< 3秒 (极致)", value: 5 }
      ]
    }
  ]
}
```

---

## 6. 数据库设计

### 6.1 项目表扩展

```sql
-- 在 projects 表新增字段
ALTER TABLE projects ADD COLUMN project_type TEXT DEFAULT 'standard';
-- 'standard': 标准项目评估
-- 'web3d': Web3D 项目评估
```

### 6.2 Web3D 风险配置表

```sql
-- 新增 Web3D 风险配置表
CREATE TABLE IF NOT EXISTS web3d_risk_items (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  step_order INTEGER NOT NULL,
  step_name TEXT NOT NULL,
  item_name TEXT NOT NULL UNIQUE,
  description TEXT,
  weight REAL DEFAULT 1.0,
  options_json TEXT,
  created_at TEXT DEFAULT CURRENT_TIMESTAMP,
  updated_at TEXT DEFAULT CURRENT_TIMESTAMP
);

-- step_order 用于分步展示：
-- 1: 项目背景与场景定义
-- 2: 数据资产现状
-- 3: 视觉与渲染要求
-- 4: 交互与业务逻辑
-- 5: 性能基准线
```

### 6.3 Web3D 工作量模板表

```sql
-- 新增 Web3D 工作量估算模板
CREATE TABLE IF NOT EXISTS web3d_workload_templates (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  category TEXT NOT NULL, -- 'data_processing', 'core_dev', 'business_logic'
  item_name TEXT NOT NULL,
  description TEXT,
  base_days REAL NOT NULL,
  unit TEXT, -- '个', '栋', '1000平米' 等
  created_at TEXT DEFAULT CURRENT_TIMESTAMP,
  updated_at TEXT DEFAULT CURRENT_TIMESTAMP
);
```

---

## 7. API 设计

### 7.1 Web3D 配置 API

```
GET  /api/web3d/config
POST /api/web3d/config/risk-items
PUT  /api/web3d/config/risk-items/:id
DELETE /api/web3d/config/risk-items/:id

GET  /api/web3d/config/workload-templates
POST /api/web3d/config/workload-templates
PUT  /api/web3d/config/workload-templates/:id
DELETE /api/web3d/config/workload-templates/:id
```

### 7.2 Web3D 项目评估 API

```
POST /api/web3d/projects          # 保存 Web3D 项目评估
GET  /api/web3d/projects          # 获取 Web3D 项目列表
GET  /api/web3d/projects/:id      # 获取 Web3D 项目详情
PUT  /api/web3d/projects/:id      # 更新 Web3D 项目
DELETE /api/web3d/projects/:id    # 删除 Web3D 项目

POST /api/web3d/projects/:id/calculate  # 计算报价
GET  /api/web3d/projects/:id/export     # 导出报告
```

---

## 8. 页面原型设计（文本框线图）

### 8.1 新建评估页面 (Web3DAssessment/New)

```
┌──────────────────────────────────────────────────────────────────────────────────────────────────────┐
│  Web3D 项目评估 - 新建评估                                                                        │
├──────────────────────────────────────────────────────────────────────────────────────────────────────┤
│  项目基本信息                                                                                    │
│  ┌────────────────────────────────────────────────┐  ┌────────────────────────────────────────────────┐  │
│  │ 项目名称： [___________________________] │  │ 客户名称： [___________________________] │  │
│  └────────────────────────────────────────────────┘  └────────────────────────────────────────────────┘  │
├──────────────────────────────────────────────────────────────────────────────────────────────────────┤
│  Steps: [●1 项目背景] [○2 数据资产] [○3 开发需求] [○4 工作量] [○5 生成总览]                       │
├──────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                    │
│  Step 1: 项目背景与技术选型                                                                      │
│                                                                                                    │
│  技术路线：                                                                                        │
│  [ ] Three.js（推荐）  [ ] Cesium  [ ] Unity WebGL  [ ] Unreal Pixel Streaming                      │
│  [ ] Babylon.js  [ ] 混合方案（请注明：_______________________）                                       │
│                                                                                                    │
│  场景类型：                                                                                        │
│  ( ) 单一产品展示   ( ) 室内/楼层   ( ) 园区/单体建筑(BIM)   ( ) 城市级/大地图(GIS)          │
│                                                                                                    │
│  业务目标：                                                                                        │
│  ( ) 营销展示   ( ) 业务管理   ( ) 炫酷大屏   ( ) 培训仿真                                      │
│                                                                                                    │
│  部署环境：                                                                                        │
│  [ ] PC 浏览器   [ ] 移动端(H5/小程序)   [ ] 展厅大屏   [ ] 混合部署                          │
│                                                                                                    │
│  ┌─────────────────────────────────────────────────────────────────────────────────────────────┐  │
│  │ 💡 技术建议：根据您的选择，我们建议使用 Three.js                                          │  │
│  │    • 包体小、加载快                                                                         │  │
│  │    • 生态丰富，与前端框架集成好                                                         │  │
│  └─────────────────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                                    │
│                                                               [上一步]  [下一步: 数据资产 →]  │
└──────────────────────────────────────────────────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────────────────────────────────────────────────┐
│  Step 2: 数据资产现状评估 ⚠️                                                                      │
├──────────────────────────────────────────────────────────────────────────────────────────────────────┤
│  数据源状况：（最重要！）                                                                       │
│  ( ) 有现成 glTF/GLB 模型                                                                         │
│  ( ) 有 Revit/IFC 等 BIM 模型                                                                     │
│  ( ) 只有 CAD/图纸                                                                                │
│  ( ) 只有照片/视频                                                                                │
│  ( ) 啥也没有，需凭空想象                                                                        │
│                                                                                                    │
│  数据质量：                                                                                        │
│  ( ) 已做过轻量化   ( ) 原始设计稿（未处理）                                                    │
│                                                                                                    │
│  数据语义：                                                                                        │
│  ( ) 已拆分单体   ( ) 是一整坨 Mesh                                                               │
│                                                                                                    │
│  ┌─────────────────────────────────────────────────────────────────────────────────────────────┐  │
│  │ ⚠️ 风险警告：                                                                              │  │
│  │ 没有现成模型将会大幅增加工期，预计增加50%-200%的数据处理时间。                      │  │
│  │ 如果原始模型未做轻量化，将需要额外3-5天/栋的清洗时间。                             │  │
│  └─────────────────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                                    │
│                                                      [← 上一步]  [下一步: 开发需求 →]  │
└──────────────────────────────────────────────────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────────────────────────────────────────────────┐
│  Step 3: 开发需求评估（视觉 + 交互 + 性能）                                                      │
├──────────────────────────────────────────────────────────────────────────────────────────────────────┤
│  【视觉渲染】                                                                                    │
│  美术风格： ( ) 极简风   ( ) 科技风   ( ) 写实风                                                │
│  光影特效： [ ] 无   [ ] 泛光   [ ] 动态阴影   [ ] 天气系统                                     │
│  动画需求： [ ] 无   [ ] 漫游动画   [ ] 构件动画   [ ] 粒子效果                                 │
│                                                                                                    │
│  【交互逻辑】                                                                                    │
│  基础交互： ( ) 仅旋转/缩放   ( ) 限制视角   ( ) 第一/三人称切换                            │
│  选中反馈： ( ) 无需选中   ( ) 悬停/点击高亮   ( ) 多选/框选                                  │
│  业务挂载： ( ) 无需联动   ( ) 点击弹窗   ( ) 3D标签   ( ) 列表联动                          │
│  复杂功能： ( ) 无   ( ) 测量工具   ( ) 剖切   ( ) 路径规划                                     │
│                                                                                                    │
│  【性能要求】                                                                                    │
│  目标 FPS：        ( ) > 30帧   ( ) > 50帧   ( ) > 60帧                                         │
│  首屏加载时间：   ( ) < 15秒   ( ) < 5秒   ( ) < 3秒                                          │
│                                                                                                    │
│                                                      [← 上一步]  [下一步: 工作量 →]  │
└──────────────────────────────────────────────────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────────────────────────────────────────────────┐
│  Step 4: 工作量估算                                                                              │
├──────────────────────────────────────────────────────────────────────────────────────────────────────┤
│  A. 数据处理工时                                                                              │
│  ┌────────────────────────────────────────────────────────────────────────────────────────────┐  │
│  │ 模型数量： [___] 栋      单栋工时： [___] 天      小计： [____] 天               │  │
│  └────────────────────────────────────────────────────────────────────────────────────────────┘  │
│  B. 核心开发工时                                                                              │
│  ┌────────────────────────────────────────────────────────────────────────────────────────────┐  │
│  │ 场景搭建 + 基础交互： [____] 天                                                   │  │
│  │ UI 联调：                [____] 天                                                   │  │
│  │ Shader/特效：          [____] 天                                                   │  │
│  │                                                                        小计： [____] 天  │  │
│  └────────────────────────────────────────────────────────────────────────────────────────────┘  │
│  C. 业务逻辑工时                                                                              │
│  ┌────────────────────────────────────────────────────────────────────────────────────────────┐  │
│  │ 简单点击弹窗：          [____] 天                                                   │  │
│  │ 复杂图表联动/数据对接： [____] 天                                                   │  │
│  │                                                                        小计： [____] 天  │  │
│  └────────────────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                                    │
│  D. 风险系数： ( ) 1.0  ( ) 1.5  ( ) 2.0  [ ] +0.3 (混合方案)                                     │
│                                                                                                    │
│  ┌────────────────────────────────────────────────────────────────────────────────────────────┐  │
│  │ 总工时 = (A + B + C) × D = _______ 天                                                 │  │
│  └────────────────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                                    │
│                                                      [← 上一步]  [下一步: 总览 →]  │
└──────────────────────────────────────────────────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────────────────────────────────────────────────┐
│  Step 5: 生成总览与报价                                                                        │
├──────────────────────────────────────────────────────────────────────────────────────────────────────┤
│  项目信息                                                                                      │
│  ┌────────────────────────────────────────────────────────────────────────────────────────────┐  │
│  │ 项目名称： 某某智慧园区 3D 可视化平台                                                   │  │
│  │ 客户名称： 某某科技公司                                                                  │  │
│  │ 技术选型： Three.js                                                                    │  │
│  │ 场景类型： 园区/单体建筑(BIM)                                                          │  │
│  └────────────────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                                    │
│  工作量明细                                                                                      │
│  ┌────────────────────────────────────────────────────────────────────────────────────────────┐  │
│  │ A. 数据处理：    5.0 天                                                                  │  │
│  │ B. 核心开发：    7.0 天                                                                  │  │
│  │ C. 业务逻辑：    3.0 天                                                                  │  │
│  │ D. 风险系数：    1.5                                                                     │  │
│  │ -------------------------                                                                   │  │
│  │ 总工时：        22.5 天                                                                 │  │
│  └────────────────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                                    │
│  成本计算                                                                                        │
│  ┌────────────────────────────────────────────────────────────────────────────────────────────┐  │
│  │ 人日单价：  ￥1200 元/天                                                               │  │
│  │ 总成本：     ￥ 27,000 元                                                               │  │
│  └────────────────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                                    │
│                                      [← 上一步]  [保存项目]  [导出 PDF]  [导出 Excel]  │
└──────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

### 8.2 历史项目页面 (Web3DAssessment/History)

```
┌──────────────────────────────────────────────────────────────────────────────────────────────────────┐
│  Web3D 项目评估 - 历史项目列表                                                                    │
├──────────────────────────────────────────────────────────────────────────────────────────────────────┤
│  │ 项目名称          | 技术路线    | 报价总计(万) | 风险总分 | 创建时间       | 操作                  │
│  ├──────────────────────────────────────────────────────────────────────────────────────────┤
│  │ 智慧园区3D平台   | Three.js   | 27.00       | 68/100   | 2024-12-01 10:30 | [查看] [重新评估] [导出] [删除] │
│  │ 工地安全监控   | Cesium     | 42.00       | 85/100   | 2024-11-28 15:22 | [查看] [重新评估] [导出] [删除] │
│  │ 产品展示系统     | Three.js   | 14.40       | 32/100   | 2024-11-25 09:15 | [查看] [重新评估] [导出] [删除] │
│  │ VR培训模拟     | Unity WGL  | 54.00       | 92/100   | 2024-11-20 14:00 | [查看] [重新评估] [导出] [删除] │
│  └──────────────────────────────────────────────────────────────────────────────────────────┘
│                                                                                                    │
│  共 4 条记录                                                                     [第 1/1 页]  │
└──────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

### 8.3 项目详情页面 (Web3DAssessment/Detail)

```
┌──────────────────────────────────────────────────────────────────────────────────────────────────────┐
│  项目详情 - 智慧园区 3D 可视化平台                                         [重新评估] [导出]  │
├──────────────────────────────────────────────────────────────────────────────────────────────────────┤
│  Tabs: [● 项目概览] [○ 风险评分详情] [○ 工作量明细]                                           │
├──────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                    │
│  ===== Tab 1: 项目概览 =====                                                                       │
│                                                                                                    │
│  项目基本信息                                                                                      │
│  ┌────────────────────────────────────────────────────────────────────────────────────────────┐  │
│  │ 项目名称： 智慧园区 3D 可视化平台                                                       │  │
│  │ 技术选型： Three.js                                                                      │  │
│  │ 场景类型： 园区/单体建筑 (BIM)                                                          │  │
│  │ 业务目标： 业务管理                                                                      │  │
│  │ 部署环境： PC 浏览器、移动端                                                              │  │
│  │ 创建时间： 2024-12-01 10:30:15                                                            │  │
│  └────────────────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                                    │
│  成本概览                                                                                        │
│  ┌────────────────────────────────────────────────┐  ┌────────────────────────────────────────────────┐  │
│  │     数据处理                               │  │     核心开发                               │  │
│  │                                                │  │                                                │  │
│  │         5.0 天                            │  │         7.0 天                            │  │
│  └────────────────────────────────────────────────┘  └────────────────────────────────────────────────┘  │
│  ┌────────────────────────────────────────────────┐  ┌────────────────────────────────────────────────┐  │
│  │     业务逻辑                               │  │     风险系数                               │  │
│  │                                                │  │                                                │  │
│  │         3.0 天                            │  │          1.5                             │  │
│  └────────────────────────────────────────────────┘  └────────────────────────────────────────────────┘  │
│                                                                                                    │
│  ┌────────────────────────────────────────────────────────────────────────────────────────────┐  │
│  │ 总工时：       22.5 天                                                                  │  │
│  │ 人日单价：     ￥ 1200 元/天                                                              │  │
│  │ -------------------------                                                                   │  │
│  │ 报价总计：     ￥ 27.00 万元                                                               │  │
│  └────────────────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                                    │
│  ===== Tab 2: 风险评分详情 =====                                                                 │
│                                                                                                    │
│  风险总分： 68 / 100                                           【中风险】                  │
│                                                                                                    │
│  │ 风险项        | 当前选项                    | 分数   | 最高分 | 风险等级         │
│  ├──────────────────────────────────────────────────────────────────────────────────────────┤
│  │ 技术路线    | Three.js                    | 2.0    | 12.0    | 低风险           │
│  │ 场景类型    | 园区/单体建筑(BIM)      | 3.0    | 4.0     | 中风险           │
│  │ 业务目标    | 业务管理                  | 3.0    | 4.0     | 中风险           │
│  │ 部署环境    | PC + 移动端               | 7.5    | 7.5     | 高风险           │
│  │ 数据源状况  | 有 BIM 模型                 | 9.0    | 18.0    | 中风险           │
│  │ 数据质量    | 原始设计稿(未处理)      | 12.5   | 12.5    | 高风险           │
│  │ 数据语义    | 已拆分单体                | 2.0    | 8.0     | 低风险           │
│  │ 美术风格    | 科技风                      | 4.5    | 6.0     | 中风险           │
│  │ ...                                                                                      │
│  └──────────────────────────────────────────────────────────────────────────────────────────┘
│                                                                                                    │
│  ===== Tab 3: 工作量明细 =====                                                                   │
│                                                                                                    │
│  A. 数据处理明细                                                                              │
│  ┌────────────────────────────────────────────────────────────────────────────────────────────┐  │
│  │ 工作项              | 单位 | 数量 | 单位工时 | 工作量小计                          │  │
│  ├────────────────────────────────────────────────────────────────────────────────────────────┤  │
│  │ Revit 清洗轻量化 | 栋   | 1    | 3.5 天  | 3.5 天                           │  │
│  │ 贴图修复         | 栋   | 1    | 1.5 天  | 1.5 天                           │  │
│  │                                                                        小计： 5.0 天  │  │
│  └────────────────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                                    │
│  B. 核心开发明细                                                                              │
│  ┌────────────────────────────────────────────────────────────────────────────────────────────┐  │
│  │ 场景搭建 + 基础交互： 3.0 天                                                           │  │
│  │ UI 联调：                2.0 天                                                           │  │
│  │ Shader/特效：          2.0 天                                                           │  │
│  │                                                                        小计： 7.0 天  │  │
│  └────────────────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                                    │
│  C. 业务逻辑明细                                                                              │
│  ┌────────────────────────────────────────────────────────────────────────────────────────────┐  │
│  │ 点击弹窗：              1.0 天                                                           │  │
│  │ 图表联动/数据对接：  2.0 天                                                           │  │
│  │                                                                        小计： 3.0 天  │  │
│  └────────────────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                                    │
└──────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

### 8.4 Web3D 风险评估配置页面 (Config/Web3DRisk)

```
┌──────────────────────────────────────────────────────────────────────────────────────────────────────┐
│  配置管理 - Web3D 风险评估                                                                       │
├──────────────────────────────────────────────────────────────────────────────────────────────────────┤
│  [按步骤筛选]  ( ) 全部  ( ) Step 1  ( ) Step 2  ( ) Step 3                      [添加新项 +]  │
├──────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                    │
│  Step 1: 项目背景与技术选型                                                                  │
│  ┌────────────────────────────────────────────────────────────────────────────────────────────┐  │
│  │ 风险项      | 描述            | 权重 | 备选项配置                          | 操作      │  │
│  ├────────────────────────────────────────────────────────────────────────────────────────────┤  │
│  │ 技术路线  | 核心技术选型  | 2.0  | Three.js(1), Cesium(3)...     | [编辑] [删除] │  │
│  │ 场景类型  | 宏观 vs 微观   | 1.0  | 单一产品(1), 室内(2)...        | [编辑] [删除] │  │
│  │ 业务目标  | 核心用途      | 1.0  | 营销展示(2), 炫酷大屏(4)...  | [编辑] [删除] │  │
│  │ 部署环境  | 硬件与终端    | 1.5  | PC(1), 移动端(5)...           | [编辑] [删除] │  │
│  └────────────────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                                    │
│  Step 2: 数据资产现状                                                                          │
│  ┌────────────────────────────────────────────────────────────────────────────────────────────┐  │
│  │ 数据源状况 | 是否有现成模型 | 3.0  | glTF模型(1), BIM模型(3)...    | [编辑] [删除] │  │
│  │ 数据质量  | 轻量化程度    | 2.5  | 已轻量化(1), 原始稿(5)...    | [编辑] [删除] │  │
│  │ 数据语义  | 构件拆分情况  | 2.0  | 已拆分(1), 整坨Mesh(4)... | [编辑] [删除] │  │
│  └────────────────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                                    │
│  Step 3: 开发需求评估                                                                          │
│  ┌────────────────────────────────────────────────────────────────────────────────────────────┐  │
│  │ 美术风格  | 期望的渲染效果 | 1.5  | 极简风(1), 科技风(3)...     | [编辑] [删除] │  │
│  │ 光影特效  | 后期处理需求  | 1.5  | 无特效(1), 泛光(2)...        | [编辑] [删除] │  │
│  │ 基础交互  | 鼠标操作      | 1.0  | 旋转/缩放(1), 限制视角(2)...  | [编辑] [删除] │  │
│  │ 复杂功能  | 高级逻辑      | 2.5  | 无(1), 测量工具(3)...         | [编辑] [删除] │  │
│  └────────────────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                                    │
│                                                                           [保存配置]  │
└──────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

---

## 9. 前端路由设计

```typescript
// .umirc.ts 新增路由
{
  path: '/web3d',
  name: 'Web3D项目评估',
  icon: 'box-plot',
  routes: [
    {
      path: '/web3d/new',
      name: '新建评估',
      component: './Web3DAssessment/New',
    },
    {
      path: '/web3d/history',
      name: '历史项目',
      component: './Web3DAssessment/History',
    },
    {
      path: '/web3d/detail/:id',
      name: '项目详情',
      component: './Web3DAssessment/Detail',
      hideInMenu: true,
    },
  ],
},
{
  path: '/config',
  name: '配置管理',
  routes: [
    // 现有路由保持不动...
    {
      path: '/config/risk',
      name: '风险配置',
      component: './Config/Risk',  // 保持不动
    },
    {
      path: '/config/roles',
      name: '角色配置',
      component: './Config/Roles',  // 保持不动
    },
    {
      path: '/config/web3d-risk',
      name: 'Web3D风险评估',  // 新增独立 Sheet 页
      component: './Config/Web3DRisk',
    },
  ],
},
```

---

## 9. 后续优化 (V1.2.0+)

### 9.1 AI 评估能力
- 接入大语言模型，根据项目描述自动填充风险评分
- 支持上传参考图片/视频，AI 分析模型复杂度

### 9.2 模块引用
- 正常项目评估模块可引用 Web3D 项目的模块
- 支持混合项目评估（如"传统 SaaS + 3D 可视化大屏"）

### 9.3 模型预检工具
- 支持上传 glTF/GLB 文件进行预检
- 自动分析面数、DrawCalls、文件大小
- 给出轻量化建议

---

## 10. 实施计划

### Phase 1: 基础框架 (预计 3 天)
- [ ] 数据库表结构创建
- [ ] 后端 API 骨架
- [ ] 前端路由和页面骨架

### Phase 2: 配置管理 (预计 2 天)
- [ ] Web3D 风险配置页面
- [ ] 工作量模板配置
- [ ] 初始化种子数据

### Phase 3: 新建评估 (预计 5 天)
- [ ] Step 1-5 风险评估表单
- [ ] Step 6 工作量估算组件
- [ ] Step 7 生成总览与报价

### Phase 4: 历史项目 (预计 2 天)
- [ ] 项目列表页面
- [ ] 项目详情页面
- [ ] 重新评估功能

### Phase 5: 测试与文档 (预计 2 天)
- [ ] 单元测试
- [ ] 集成测试
- [ ] 用户文档

**预计总工期**: 14 人天

---

## 附录

### A. Web3D 技术选型对照表

| 场景 | 推荐技术 | 原因 |
|------|----------|------|
| 城市级/大地图 | Cesium | 原生支持 GIS 坐标系和 3D Tiles |
| 园区/单体建筑 | Three.js | 灵活、生态丰富、与前端框架集成好 |
| 室内/楼层 | Three.js | 性能更好，交互更灵活 |
| 产品展示/轻量交互 | Three.js / Babylon.js | 包体小、加载快 |
| 复杂物理模拟/游戏 | Unity WebGL | 内置物理引擎、编辑器强大 |
| 极致画质/大型仿真 | Unreal Pixel Streaming | 顶级渲染、支持光追 |
| 混合场景（宏观+微观） | Cesium + Three.js | 需处理双引擎切换，复杂度高 |

### B. 技术路线风险对照表

| 技术路线 | 风险等级 | 主要风险点 |
|----------|----------|------------|
| Three.js | 低 | 需手写交互逻辑 |
| Babylon.js | 低 | 生态不如 Three.js |
| Cesium | 中 | 学习曲线陡、定制成本高 |
| Unity WebGL | 中高 | 包体大、不支持移动端、与 Web 交互困难 |
| Unreal Pixel Streaming | 高 | 需服务器集群、带宽成本高、延迟问题 |
| 混合方案 | 高 | 坐标系转换、双引擎切换、调试困难 |

### C. 参考文档
- Web3D 项目需求评估检查表 (v1.0)
- Web3D 课程管理 - 技术栈大乱斗与选型决策
- Web3D 课程管理 - 数据源头与软件生态
- Web3D 课程管理 - 模型轻量化处理实战
