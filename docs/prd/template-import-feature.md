# 从模板导入功能说明

## 功能概述

在新建评估页面添加"从模板导入"功能，允许用户从历史项目中选择一个作为模板，快速导入其评估数据，避免重复填写相似项目的评估信息。

## 功能位置

- **页面**: `/assessment/new` (新建评估页面)
- **入口**: 页面顶部统计卡片右侧的"从模板导入"按钮

## 功能详情

### 1. 触发导入

- 点击页面顶部的**"从模板导入"**按钮
- 按钮使用 `ImportOutlined` 图标，主题色按钮
- 按钮位置：统计卡片右侧，与风险统计数据并列显示

### 2. 模板选择弹窗

弹窗展示所有历史项目列表，包含以下信息：

| 列名 | 说明 | 宽度 |
|------|------|------|
| 项目名称 | 项目的名称 | 200px |
| 描述 | 项目描述信息 | 自适应 |
| 是否模板 | 标识项目类型（模板/项目） | 100px |
| 风险得分 | 项目的最终风险评分 | 100px |
| 总成本(万元) | 项目总成本，以万元为单位显示 | 120px |
| 创建时间 | 项目创建时间 | 180px |
| 操作 | 导入按钮 | 100px |

**特性**：
- 表格支持分页，默认每页显示 10 条
- 显示总记录数
- 如果是编辑模式，自动过滤掉当前正在编辑的项目
- 模板项目用蓝色标签标识，普通项目用灰色标签

### 3. 导入操作

1. 点击某个项目行的**"导入"**按钮
2. 系统自动从该项目的 `assessment_details_json` 中解析评估数据
3. 将以下数据导入到当前表单：
   - ✅ 风险评分 (`risk_scores`)
   - ✅ 新功能开发工作量 (`development_workload`)
   - ✅ 系统对接工作量 (`integration_workload`)
   - ✅ 差旅月数和人数 (`travel_months`, `travel_headcount`)
   - ✅ 运维月数和人数 (`maintenance_months`, `maintenance_headcount`)
   - ✅ 运维日成本 (`maintenance_daily_cost`)
   - ✅ 风险项清单 (`risk_items`)

4. 导入成功后：
   - 关闭弹窗
   - 显示成功提示消息，包含源项目名称
   - 表单自动填充导入的数据
   - 页面顶部统计数据自动更新

## 技术实现

### 前端改动

#### 1. 新增 API 接口

文件：`frontend/ppa_frontend/src/services/assessment/index.ts`

```typescript
/** 获取所有项目列表（用于模板选择） GET /api/projects */
export async function getAllProjects(options?: { [key: string]: any }) {
  return request<{
    data: API.ProjectInfo[];
  }>('/api/projects', {
    method: 'GET',
    ...(options || {}),
  });
}
```

#### 2. 页面状态管理

新增以下状态：
- `templateModalOpen`: 控制模板选择弹窗的显示/隐藏
- `templateList`: 存储历史项目列表
- `loadingTemplates`: 加载项目列表的 loading 状态

#### 3. 核心函数

**`handleOpenTemplateModal`**
- 打开模板选择弹窗
- 加载所有历史项目
- 过滤掉当前编辑的项目（编辑模式下）

**`handleImportFromTemplate`**
- 根据项目 ID 获取详细数据
- 解析 `assessment_details_json`
- 数据标准化处理
- 填充到表单中

### 后端接口

使用现有接口：
- `GET /api/projects` - 获取所有项目列表
- `GET /api/projects/:id` - 获取单个项目详情

## 用户体验优化

### 1. 响应式布局
- 顶部按钮区域使用响应式栅格布局
- 移动端自动调整为垂直布局
- 表格列支持省略号显示长文本

### 2. 数据安全
- 导入前进行数据验证和标准化
- 空值和异常值处理
- 防止导入损坏的数据

### 3. 用户反馈
- 加载状态提示（Loading）
- 成功/失败消息提示
- 显示源项目名称增强可读性

### 4. 交互细节
- 弹窗宽度 1000px，适合查看完整信息
- 使用 `destroyOnClose` 确保每次打开都是最新数据
- 表格固定操作列，方便点击

## 使用场景

### 场景 1：相似项目评估
公司接到多个类似的项目需求，可以选择之前的项目作为模板，快速完成基础评估。

### 场景 2：定期项目复制
对于周期性的项目（如年度运维项目），可以导入上一期的数据，只需调整少量参数。

### 场景 3：标准模板应用
将典型项目标记为模板，新项目评估时直接导入标准配置，保证评估一致性。

## 注意事项

1. **编辑模式保护**：编辑现有项目时，不会在模板列表中显示当前项目本身
2. **数据覆盖提醒**：导入操作会覆盖当前所有已填写的数据（可考虑后续添加确认提示）
3. **配置兼容性**：导入的数据基于当前系统配置（角色、风险项），如果配置变更可能需要手动调整

## 后续优化方向

### 短期优化
- [ ] 添加导入前的确认提示框，防止误操作覆盖数据
- [ ] 支持搜索和筛选功能（按项目名称、描述搜索）
- [ ] 添加"仅导入模板项目"的快速筛选

### 中期优化
- [ ] 支持部分导入（只导入风险评分/只导入工作量等）
- [ ] 模板预览功能，导入前查看详细数据
- [ ] 导入历史记录，方便追溯数据来源

### 长期优化
- [ ] 模板版本管理
- [ ] 模板分类和标签
- [ ] 模板推荐机制（基于项目相似度）

## 测试建议

### 功能测试
1. ✅ 新建模式下导入历史项目数据
2. ✅ 编辑模式下导入其他项目数据（不显示当前项目）
3. ✅ 空数据项目导入处理
4. ✅ 损坏 JSON 数据的容错处理

### 界面测试
1. ✅ 不同屏幕尺寸下的响应式布局
2. ✅ 长项目名称的省略显示
3. ✅ 大数据量下的分页性能

### 边界测试
1. ✅ 网络异常时的错误提示
2. ✅ 无历史项目时的空状态
3. ✅ 并发操作的数据一致性

---

**更新日期**: 2025-10-22  
**版本**: v1.0  
**负责人**: Development Team
