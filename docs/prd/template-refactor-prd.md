# 评估模板与一键填充能力重构 PRD

**版本**: v0.1  
**最后更新**: 2025-11-21  
**适用范围**: 项目评估模块（/assessment/new），模板相关功能

---

## 1. 背景与问题

### 1.1 现状

- 第 4 步「生成总览」中存在一个勾选项：`另存为模板（is_template）`，当前只是在保存参数中带一个布尔字段，前端没有任何后续联动逻辑，用户感知弱。
- 第 1 步、 第 2 步中分别有「一键填充样例数据」按钮：
  - 第 1 步：按配置给每个风险项填一个固定分值，用于快速演示。
  - 第 2 步：写死了一组开发/对接样例行，用于展示表格效果。
- 模板导入功能（从历史项目导入评估数据）已经存在，但与「另存为模板」和「一键填充样例」是三套相互独立的逻辑：
  - 从模板导入：面向**完整评估复制**（风险 + 工作量 + 其他成本）。
  - 一键填充样例：面向**演示/测试**，且只有“系统内置样例”，与用户自己的项目无关。
  - 另存为模板：用户不知道保存后的模板在哪用、怎么用。

### 1.2 用户痛点

1. 实际评估完成后，希望把本次评估沉淀为「可复用的样例」，但目前：
   - 勾选「另存为模板」没有明显收益，用户不知道以后在哪里“用到这个模板”。
2. 测试/演示时，希望快速填入一套「真实感更强」的数据，而不是固定的演示数据：
   - 现在的一键填充只写死了一些示例，不会根据业务及过往项目更新。
3. 希望不同评估环节（风险评分、工作量估算）的一键填充来源保持一致：
   - 例如：我想“用上次 A 项目的数据作为样例”，而不是风险是系统样例、工作量又是另一套样例。

### 1.3 改造目标

1. 让「另存为模板」变成一个**有明确价值的动作**：保存后的模板能够被一键填充功能直接复用。
2. 统一「模板」与「一键填充样例数据」概念：样例不是硬编码，而是由用户（或系统）维护的一组模板。
3. 保留「系统内置样例」能力，作为模板体系的一部分，而不是完全独立的硬编码。

---

## 2. 核心概念与目标能力

### 2.1 核心概念：评估模板（Assessment Template）

> 评估模板 = 一次完整评估（风险 + 工作量 + 其他成本）的快照，用于后续快速填充和复制。

- 数据载体沿用现有 `projects` 记录：
  - 使用 `is_template = true` 标记为**当前模板项目**。
  - `assessment_details_json` 保存完整表单数据。
- 模板的**唯一性约束**：
  - 任意时刻全系统最多只允许存在 **1 条** `is_template = 1` 的项目记录，代表“当前使用的评估模板”。
  - 切换模板的唯一入口：新建/编辑评估的第 4 步，在「保存项目」区域勾选“同时保存为评估模板”；后端在处理该请求时需要：
    - 将所有其他项目的 `is_template` 置为 `0`。
    - 将当前保存的项目 `is_template` 置为 `1`，成为新的全局模板。
  - 历史项目列表中仅有一条记录会显示“模板”标识，用于说明当前模板来源。
- 本期不再引入多模板概念，后续若需要“模板库”，可在后续版本放宽唯一性约束。

### 2.2 目标能力拆解

1. **在第 4 步一键沉淀模板**
   - 用户在完成评估并保存项目时，可以勾选「保存为模板」：
     - 将本次评估记录标记为模板（`is_template = true`）。
     - 可选：支持给模板起一个单独的「模板名称/标签」。
2. **在第 1 步、第 2 步中按模板一键填充**
   - 「一键填充样例数据」不再是写死的数据，而是基于选中的「模板」：
     - 可以快速填充风险评分。
     - 可以快速填充开发/对接工作量。
   - 若用户未选择模板，则使用系统内置模板作为默认样例。
3. **保证模板与“从模板导入”一致**
   - 第 0 步（从模板创建）依然可以基于模板做**完整导入**。
   - 第 1 步/第 2 步的一键填充，仅作用在当前步骤数据（局部导入）。

---

## 3. 目标交互与流程

### 3.1 第 4 步：保存项目 & 保存为模板

#### 3.1.1 交互改造

当前表单：

- 字段：
  - `projectName`（项目名称）
  - `projectDescription`（项目描述）
  - `is_template`（另存为模板）

改造建议：

1. 文案调整：
   - 勾选项改为：`同时保存为评估模板（用于后续一键填充）`
2. 可选：增加模板名称字段（默认使用项目名称）：
   - `templateName`（可不单独存，前期可以直接用 `name`）
3. 保存行为：
   - `is_template = true` 时：
     - 正常保存项目。
     - 同一条记录作为模板出现在：
       - 第 0 步模板选择弹窗。
       - 第 1/2 步的一键填充来源列表。

#### 3.1.2 流程示意

1. 用户完成第 1~4 步评估。
2. 在「保存项目」区域勾选「同时保存为评估模板」。
3. 点击「保存项目」：
   - 后端保存项目记录 `projects`。
   - 标记 `is_template = true`，使其成为用户可见模板。
4. 下一次新建评估时：
   - 在模板选择/一键填充入口中可以看到该模板。

### 3.2 第 1 步：风险评分一键填充

#### 3.2.1 当前行为

- 按按钮「一键填充样例数据」：
  - 遍历所有风险项，从配置中取一个默认选项填入。
  - 与用户历史项目/模板无关。

#### 3.2.2 改造目标

- 按「一键填充」时，优先使用**用户选择的模板**进行填充：
  1. 若当前评估已从某个模板导入（第 0 步/顶部「从模板导入」）：
     - 一键填充 = 从该模板的 `risk_scores` 写入当前表单。
  2. 若未选择模板：
     - 提示“当前没有可用模板，请先完成一次评估并在最后一步勾选保存为模板”，不再提供硬编码样例。

### 3.3 第 2 步：工作量估算一键填充

#### 3.3.1 当前行为

- 「一键填充样例数据」：
  - 写死了一批开发/对接模块示例行，与角色配置关联，但与真实项目无关。

#### 3.3.2 改造目标

- 行为与第 1 步保持一致的“模板优先”逻辑：
  1. 若当前评估基于某模板创建：
     - 一键填充 = 导入模板的 `development_workload` 和 `integration_workload`。
  2. 否则：
     - 提示“当前没有可用模板，请先完成一次评估并在最后一步勾选保存为模板”，不再使用硬编码样例数据。

---

## 4. 数据与接口设计（增量）

### 4.1 数据结构复用

- 继续复用现有 `projects` 表结构与接口：
  - `is_template: number` 标记模板。
  - `assessment_details_json: string` 存储完整评估数据。
- 不新增新表，避免复杂度。

### 4.2 前后端接口（建议）

> 注：以下接口只是对现有接口的使用方式约定，短期内可以不新增专用 API。

1. 获取模板列表：
   - 现有：`GET /api/projects`，新增 query 参数：`?is_template=1`（前端自行过滤也可）。
2. 获取模板详情：
   - 现有：`GET /api/projects/:id`，直接读取 `assessment_details_json`。
3. 保存为模板：
   - 现有：`POST /api/projects`，body 中带 `is_template: true`。
   - 如需支持“仅作为模板不出现在历史项目列表”，可增加字段 `is_visible_in_history`（后续迭代）。

---

## 5. 兼容性与迁移策略

1. **已有项目与模板**
   - 已存在 `is_template = 1` 的项目自动视为模板，出现在模板选择列表中。
   - 一键填充也可以使用这些历史模板。
2. **模板导入功能**
   - 保持现有「从模板导入」完整导入能力不变。
   - 新增的局部一键填充仅影响当前步骤表单，不影响整体导入逻辑。

---

## 6. 迭代范围与优先级

### 6.1 第一阶段（当前迭代建议）

- 明确「保存为模板」行为并联通模板导入 / 一键填充：
  - 第 4 步：完善「同时保存为评估模板」文案和保存逻辑，确保唯一模板约束。
  - 第 1/2 步：一键填充仅基于“当前模板”工作；若不存在模板，则给出引导提示，不再使用硬编码样例。

### 6.2 后续可以考虑的增强

- 模板管理页面（列表、编辑、删除、设置默认模板）。
- 支持按模块类型拆分模板（仅风险模板、仅工作量模板等）。
- 模板标签/分类管理（如行业、项目规模）。
- 模板推荐（基于历史项目相似度推荐模板）。

---

## 7. 验收要点（前端视角）

1. 勾选「同时保存为评估模板」后，项目在历史项目列表中有明确模板标识，并可在模板弹窗中被选择。
2. 在系统没有任何模板时，一键填充按钮给出明确提示“当前无模板，请先完成一次评估并保存为模板”，不会再写入硬编码样例数据。
3. 在从模板导入后，一键填充可以复用该模板的数据，而不是另起一套样例。
4. 第 1 步、第 2 步的一键填充逻辑一致，模板来源统一，用户认知清晰。
