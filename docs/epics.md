# PPA项目史诗和用户故事分解

**作者**: bruce (产品经理)
**日期**: 2025-11-08
**项目名称**: PPA (软件项目评估系统)
**项目类型**: Web应用 + AI智能功能增强

---

## 项目概述

本史诗分解基于PPA系统的AI功能增强需求，将三个核心AI功能（AI一键风险评估、AI智能工作量估算、AI模型使用情况标注）分解为6个史诗和17个用户故事。每个故事都采用BDD格式验收标准，确保可测试性和实现指导性。

**核心价值**:
- 将复杂的项目评估逻辑与AI智能分析结合
- 提升评估效率和准确性
- 提供透明可追溯的AI辅助过程
- 与现有PPA系统无缝集成

---

## 史诗结构

### Epic 1: AI基础设施集成
**史诗目标**: 建立AI功能基础架构，实现与现有系统的无缝集成
**依赖关系**: 后续所有史诗的基础
**预计交付**: 完整的AI服务架构和模块集成

### Epic 2: AI风险评估功能  
**史诗目标**: 实现第一步AI智能风险评估，提升风险识别准确性
**依赖关系**: 基于Epic 1的AI基础设施
**预计交付**: 完整的AI风险评估工作流

### Epic 3: AI工作量估算功能
**史诗目标**: 实现第二步AI智能工作量估算，简化工作复杂度  
**依赖关系**: 基于Epic 1的AI基础设施
**预计交付**: AI模块梳理和智能工作量评估

### Epic 4: AI使用情况标注
**史诗目标**: 在第四步透明展示AI辅助过程，提升用户信任
**依赖关系**: 基于Epic 2和Epic 3的功能使用
**预计交付**: AI使用情况展示面板和统计

### Epic 5: 数据流程和持久化
**史诗目标**: 确保AI功能数据的完整性和可追溯性
**依赖关系**: 基于Epic 2-4的功能实现
**预计交付**: AI数据的存储、查询和导出

### Epic 6: 用户体验优化  
**史诗目标**: 提升AI功能的易用性和用户满意度
**依赖关系**: 基于Epic 1-5的功能实现
**预计交付**: 完整的UI/UX优化

---

## 详细用户故事

## Epic 1: AI基础设施集成

### Story 1.1: AI服务基础架构搭建
**用户故事**: 作为系统开发者，我想要建立AI服务基础架构，以便能够调用和集成用户配置的AI模型

**验收标准**:
**Given** 用户已配置AI模型（GPT-4等）并在模型配置模块中设置
**When** 系统初始化AI服务时
**Then** 成功获取用户当前配置的模型信息和API密钥
**And** 建立统一的AI服务调用接口
**And** 具备基础的错误处理和重试机制

**技术要点**: 创建AIService类，集成现有模型配置API，设计统一的调用接口

### Story 1.2: 与模型配置模块集成
**用户故事**: 作为系统开发者，我想要AI功能能够读取和集成现有的模型配置数据

**验收标准**:
**Given** 系统中已有AI模型配置数据
**When** AI功能需要获取模型信息时
**Then** 成功从 `/api/config/ai-models` 获取当前模型配置
**And** 支持模型切换和配置更新
**And** 确保API调用失败时有合适的降级处理

**技术要点**: RESTful API集成，数据缓存机制，错误处理

### Story 1.3: 与提示词管理模块集成
**用户故事**: 作为系统开发者，我想要AI功能能够获取和管理现有的提示词模板

**验收标准**:
**Given** 系统中已有提示词模板数据
**When** AI分析需要选择提示词模板时
**Then** 成功从 `/api/ai/prompts` 获取可用提示词列表
**And** 支持提示词变量的动态配置
**And** 支持系统预置模板的只读保护

**技术要点**: 提示词模板系统，变量替换机制，权限控制

### Story 1.4: AI响应处理和错误处理
**用户故事**: 作为系统开发者，我想要AI服务能够处理各种响应格式和错误情况

**验收标准**:
**Given** AI模型返回各种格式的响应（JSON、文本等）
**When** 处理AI响应时
**Then** 能够解析和标准化JSON格式响应
**And** 对文本格式响应进行智能提取
**And** 提供统一的错误处理和用户提示
**And** 具备网络超时和重试机制

## Epic 2: AI风险评估功能

### Story 2.1: AI一键风险评估弹窗实现
**用户故事**: 作为项目经理，我想要在风险评分页面中有一个AI评估按钮，可以打开专门的评估弹窗

**验收标准**:
**Given** 用户在风险评分步骤中
**When** 点击"🤖 AI智能风险评估"按钮时
**Then** 弹出1000px宽度的AI评估模态框
**And** 弹窗包含项目文档输入区域
**And** 弹窗包含提示词选择和配置区域
**And** 弹窗显示"开始AI评估"操作按钮

**技术要点**: Modal组件设计，表单布局，状态管理

### Story 2.2: 项目文档输入和分析功能
**用户故事**: 作为项目经理，我想要能够输入项目招标文件内容并选择分析模板

**验收标准**:
**Given** AI评估弹窗已打开
**When** 用户输入项目描述并选择提示词模板时
**Then** 支持最大5000字符的文档输入
**And** 能够选择可用的AI分析模板
**And** 支持模板变量的动态配置
**And** 表单验证确保必要字段已填写

**技术要点**: 文本输入组件，Select选择器，表单验证

### Story 2.3: 风险项评分建议和缺失识别
**用户故事**: 作为项目经理，我想要AI能够分析项目文档并提供风险项评分建议

**验收标准**:
**Given** 用户提供了项目文档和选择了提示词模板
**When** 点击"开始AI评估"按钮时
**Then** 调用AI模型进行风险分析
**And** 显示风险项评分建议表格
**And** 展示可能缺失的风险项建议
**And** 提供总体风险评估建议
**And** 显示分析置信度

**技术要点**: AI API调用，结果解析，表格展示

### Story 2.4: 评估结果应用和表单填充
**用户故事**: 作为项目经理，我想要能够将AI评估结果应用到风险评分表单中

**验收标准**:
**Given** AI评估结果已显示
**When** 用户点击"应用评估结果"按钮时
**Then** 自动填充风险评分表单中的相关字段
**And** 更新表单数据并显示成功提示
**And** 关闭评估弹窗
**And** 确保数据格式正确

**技术要点**: 表单数据更新，状态同步，用户反馈

## Epic 3: AI工作量估算功能

### Story 3.1: AI项目模块梳理器基础实现
**用户故事**: 作为项目经理，我想要在第二步中有一个AI模块梳理标签页

**验收标准**:
**Given** 用户在第二步工作量估算页面中
**When** 切换到"AI模块梳理"标签时
**Then** 显示AI模块分析界面
**And** 包含项目类型和规模选择
**And** 包含项目描述输入区域
**And** 包含分析配置选项

**技术要点**: Tabs组件，表单布局，状态管理

### Story 3.2: 模块结构生成和展示功能
**用户故事**: 作为项目经理，我想要AI能够分析项目描述并生成功能模块结构

**验收标准**:
**Given** 用户填写了项目类型、规模和描述
**When** 点击"开始AI模块分析"时
**Then** 调用AI分析项目需求
**And** 生成5-8个功能模块
**And** 每个模块包含三级结构（module1/module2/module3）
**And** 显示项目分析总结
**And** 提供"导入到新功能开发"功能

**技术要点**: AI API调用，结果解析，表格展示

### Story 3.3: 单模块一键工作量评估
**用户故事**: 作为项目经理，我想要能够对任意模块进行一键AI工作量评估

**验收标准**:
**Given** 工作量估算列表中有模块数据
**When** 点击模块的"一键评估"按钮时
**Then** 弹出AI工作量评估结果窗口
**And** 显示各角色工作量评估结果
**And** 计算总工时和成本
**And** 提供"应用评估结果"功能

**技术要点**: 批量操作，Modal组件，结果计算

### Story 3.4: 批量AI评估和结果应用
**用户故事**: 作为项目经理，我想要能够批量选择多个模块进行AI评估

**验收标准**:
**Given** 在新功能开发标签页中
**When** 选择多个模块并点击"批量AI评估"时
**Then** 显示批量评估进度
**And** 逐个调用AI评估每个模块
**And** 显示评估进度百分比
**And** 所有评估完成后自动应用结果

**技术要点**: 进度显示，批量处理，状态管理

## Epic 4: AI使用情况标注

### Story 4.1: AI使用情况数据收集
**用户故事**: 作为系统，我想要在用户使用AI功能时自动收集使用情况信息

**验收标准**:
**Given** 用户使用AI功能（风险评估、模块分析、工作量评估）
**When** AI功能完成时
**Then** 自动记录使用的模型信息
**And** 记录提示词模板信息
**And** 记录功能特性和置信度
**And** 记录使用时间戳

**技术要点**: 数据收集机制，存储结构，时间戳管理

### Story 4.2: 第四步AI使用情况展示
**用户故事**: 作为用户，我想要在第四步总览中看到所有AI辅助环节的详情

**验收标准**:
**Given** 在第四步总览页面中
**When** 页面加载时
**Then** 显示"🤖 AI模型使用情况"面板
**And** 统计AI辅助环节数量
**And** 详细展示每个AI功能的使用情况
**And** 显示模型信息和功能特性

**技术要点**: 面板组件，统计展示，详情布局

### Story 4.3: AI使用情况可视化
**用户故事**: 作为用户，我想要看到AI使用情况的可视化统计和进度

**验收标准**:
**Given** AI使用情况面板已显示
**When** 查看使用统计时
**Then** 显示AI辅助环节和模型调用次数
**And** 显示各功能特性的标签
**And** 显示使用时间线
**And** 提供置信度进度条

**技术要点**: 统计组件，标签展示，进度条，进度显示

## Epic 5: 数据流程和持久化

### Story 5.1: AI评估结果数据结构设计
**用户故事**: 作为系统开发者，我想要设计合适的数据结构来存储AI评估结果

**验收标准**:
**Given** 需要存储AI评估相关的所有数据
**When** 设计数据模型时
**Then** 能够存储风险评估结果
**And** 能够存储模块分析结果
**And** 能够存储工作量评估结果
**And** 支持数据关联和查询

**技术要点**: 数据模型设计，关系设计，索引优化

### Story 5.2: 评估报告中的AI信息集成
**用户故事**: 作为用户，我想要在评估报告中看到AI使用情况的完整信息

**验收标准**:
**Given** 生成评估报告时
**When** 包含AI使用情况时
**Then** 在报告中显示AI辅助环节
**And** 显示使用的模型和提供商
**And** 显示AI功能特性和置信度
**And** 保持报告格式的专业性

**技术要点**: 报告生成，模板集成，格式化

### Story 5.3: 导出功能的AI使用标注
**用户故事**: 作为用户，我想要在PDF和Excel导出中包含AI使用情况

**验收标准**:
**Given** 导出评估报告时
**When** 包含AI使用信息时
**Then** PDF报告中包含AI使用情况章节
**And** Excel导出生成AI使用情况工作表
**And** 导出数据格式专业且可读
**And** 导出过程稳定可靠

**技术要点**: PDF生成，Excel导出，格式控制

## Epic 6: 用户体验优化

### Story 6.1: AI功能界面美化
**用户故事**: 作为用户，我想要AI功能界面美观且符合设计规范

**验收标准**:
**Given** AI功能界面已实现
**When** 用户查看界面时
**Then** 界面符合Ant Design设计规范
**And** 具备合适的颜色和间距
**And** 响应式设计适配不同屏幕
**And** 具备品牌统一性

**技术要点**: UI组件设计，CSS样式，响应式设计

### Story 6.2: 加载状态和进度显示
**用户故事**: 作为用户，我想要在AI处理过程中看到清晰的加载状态和进度

**验收标准**:
**Given** AI功能正在处理时
**When** 用户等待结果时
**Then** 显示加载动画
**And** 显示处理进度百分比
**And** 显示当前处理任务描述
**And** 提供取消操作选项

**技术要点**: 加载组件，进度条，状态管理，用户交互

### Story 6.3: 错误处理和用户反馈
**用户故事**: 作为用户，我想要在AI功能出错时得到友好的错误提示和解决建议

**验收标准**:
**Given** AI功能发生错误时
**When** 用户操作失败时
**Then** 显示友好的错误信息
**And** 提供可能的解决建议
**And** 提供重试选项
**And** 错误信息不泄露敏感信息

**技术要点**: 错误处理，用户提示，重试机制，安全处理

---

## 史诗分解统计

- **史诗总数**: 6个
- **用户故事总数**: 17个
- **预计总工作量**: 45-50人天
- **开发周期**: 约2-3个月（按2人并行开发）

### 史诗工作量分布
- Epic 1: AI基础设施集成 (8人天)
- Epic 2: AI风险评估功能 (8人天)
- Epic 3: AI工作量估算功能 (8人天)
- Epic 4: AI使用情况标注 (6人天)
- Epic 5: 数据流程和持久化 (6人天)
- Epic 6: 用户体验优化 (6人天)

---

## 技术架构要点

### 核心技术栈
- **前端**: React + Ant Design + TypeScript
- **后端**: Node.js + Express + SQLite3
- **AI集成**: 与现有模型配置和提示词管理模块集成
- **数据存储**: 扩展现有数据库结构

### 关键集成点
1. **模型配置模块**: `/api/config/ai-models`
2. **提示词管理**: `/api/ai/prompts`
3. **现有评估流程**: 风险评分 → 工作量估算 → 总览
4. **导出功能**: PDF和Excel报告生成

### 性能和安全考虑
- AI调用超时和重试机制
- 用户敏感信息保护
- API限流和缓存策略
- 前端性能优化

---

## 下一步行动

1. **Epic 1实施**: 开始AI基础设施和模块集成开发
2. **技术评审**: 确认技术方案和API设计
3. **开发计划**: 制定详细的开发时间表
4. **测试策略**: 设计AI功能的测试方案
5. **用户验收**: 制定用户验收标准和流程

---

**文档版本**: v1.0
**最后更新**: 2025-11-08
**状态**: 待用户确认和实施