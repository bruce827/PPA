# 构建模块工作流

## 概述

构建模块工作流是一个交互式脚手架系统，用于创建包含代理、工作流、任务和安装基础设施的完整 BMAD 模块。它是在 BMAD 生态系统中构建新模块的主要工具，指导用户完成从概念到部署就绪结构的整个模块创建过程。

## 主要功能

- **交互式模块规划** - 通过协作会话定义模块概念、范围和架构
- **智能脚手架** - 自动创建合适的目录结构和配置文件
- **组件集成** - 与 create-agent 和 create-workflow 工作流无缝集成
- **安装基础设施** - 完整的安装程序设置，包含配置模板
- **模块简报集成** - 可使用现有模块简报作为蓝图，加速开发
- **验证与文档** - 内置验证检查和全面的 README 生成

## 使用方法

### 基本调用

```bash
workflow create-module
```

### 使用模块简报输入

```bash
# 如果您有来自 module-brief 工作流的模块简报
workflow create-module --input module-brief-my-module-2024-09-26.md
```

### 配置

工作流从 BMB 配置中加载关键变量：

- **custom_module_location**：自定义模块创建位置（默认：`bmad/`）
- **user_name**：模块作者信息
- **date**：用于版本控制的自动时间戳

## 工作流结构

### 包含的文件

```text
create-module/
├── workflow.yaml           # 配置和元数据
├── instructions.md         # 分步执行指南
├── checklist.md           # 验证标准
├── module-structure.md    # 模块架构指南
├── installer-templates/   # 安装模板
│   ├── install-config.yaml
│   └── installer.js
└── README.md             # 本文件
```

## 工作流过程

### 阶段 1：概念定义（步骤 1-2）

#### 模块愿景和身份

- 定义模块概念、目的和目标受众
- 确立模块代码（kebab-case）和友好名称
- 选择模块类别（特定领域、创意、技术、业务、个人）
- 规划组件架构，包含代理和工作流规范

#### 模块简报集成

- 自动检测输出文件夹中现有的模块简报
- 可加载并使用简报作为预填充的蓝图
- 当存在全面简报时加速规划过程

### 阶段 2：架构规划（步骤 3-4）

#### 目录结构创建

- 创建完整的模块目录层次结构
- 设置代理、工作流、任务、模板和数据文件夹
- 建立具有适当配置的安装程序目录

#### 模块配置

- 生成包含模块元数据的主 config.yaml
- 配置组件计数和引用
- 设置输出和数据文件夹规范

### 阶段 3：组件创建（步骤 5-6）

#### 交互式组件构建

- 可选：使用 create-agent 工作流创建第一个代理
- 可选：使用 create-workflow 工作流创建第一个工作流
- 为稍后构建的组件创建占位符

#### 工作流集成

- 无缝调用子工作流以创建组件
- 确保正确的文件放置和结构
- 在各组件间保持模块一致性

### 阶段 4：安装与文档（步骤 7-9）

#### 安装程序基础设施

- 创建用于部署的 install-module-config.yaml
- 设置可选的 installer.js 以实现复杂的安装逻辑
- 配置安装后消息和说明

#### 全面的文档

- 生成包含使用示例的详细 README.md
- 创建剩余组件的开发路线图
- 提供用于继续开发的快速命令

### 阶段 5：验证与最终确定（步骤 10）

#### 质量保证

- 验证目录结构和配置文件
- 检查组件引用和路径一致性
- 确保安装程序配置已准备好部署
- 提供全面的模块摘要和后续步骤

## 输出

### 生成的文件

- **模块目录**：位于 `{project-root}/bmad/{module_code}/` 的完整模块结构
- **配置文件**：config.yaml、install-module-config.yaml
- **文档**：README.md、TODO.md 开发路线图
- **组件占位符**：为代理、工作流和任务准备的结构化文件夹

### 输出结构

工作流创建一个已准备好开发的完整模块：

1. **模块身份** - 名称、代码、版本和元数据
2. **目录结构** - 正确的 BMAD 模块层次结构
3. **配置系统** - 运行时和安装配置
4. **组件框架** - 可直接使用的代理和工作流脚手架
5. **安装基础设施** - 已准备好部署的安装程序
6. **文档套件** - README、路线图和开发指南

## 要求

- **模块简报**（可选但推荐）- 先使用 module-brief 工作流以获得最佳效果
- **BMAD Core 配置** - 正确配置的 BMB config.yaml
- **构建工具访问** - create-agent 和 create-workflow 工作流必须可用

## 最佳实践

### 开始之前

1. **创建模块简报** - 运行 module-brief 工作流进行全面规划
2. **查看现有模块** - 研究 `/bmad/` 中的类似模块以了解模式和灵感
3. **定义清晰范围** - 对模块将完成的功能有具体的愿景

### 执行期间

1. **使用模块简报** - 在提示时加载现有简报以加速开发
2. **从简单开始** - 创建一个核心代理和工作流，然后迭代扩展
3. **利用子工作流** - 使用 create-agent 和 create-workflow 创建高质量组件
4. **及早验证** - 在进入下一阶段之前检查生成的结构

### 完成后

1. **遵循路线图** - 使用生成的 TODO.md 进行系统化开发
2. **测试安装** - 使用 `bmad install {module_code}` 验证安装程序
3. **迭代组件** - 使用快速命令添加代理和工作流
4. **记录进度** - 随着模块的发展更新 README.md

## 故障排除

### 常见问题

**问题**：目标位置已存在模块

- **解决方案**：选择不同的模块代码或删除现有模块
- **检查**：验证输出文件夹权限和可用空间

**问题**：子工作流调用失败

- **解决方案**：确保 create-agent 和 create-workflow 工作流可用
- **检查**：验证 config.yaml 中的工作流路径

**问题**：安装配置无效

- **解决方案**：检查 install-module-config.yaml 语法和路径
- **检查**：确保所有引用的路径正确使用 {project-root} 变量

## 自定义

要自定义此工作流：

1. **修改说明** - 更新 instructions.md 以调整脚手架步骤
2. **扩展模板** - 在 installer-templates/ 中添加新的安装程序模板
3. **更新验证** - 使用额外的质量检查增强 checklist.md
4. **添加组件** - 集成额外的子工作流以支持专用组件

## 版本历史

- **v1.0.0** - 初始版本
  - 交互式模块脚手架
  - 与 create-agent 和 create-workflow 的组件集成
  - 完整的安装基础设施
  - 模块简报集成支持

## 支持

如有问题或疑问：

- 查看 `/bmad/bmb/workflows/create-workflow/workflow-creation-guide.md` 中的工作流创建指南
- 在 `module-structure.md` 中学习模块结构模式
- 使用 `checklist.md` 验证输出
- 参考 `/bmad/` 中的现有模块作为示例

---

此文档为 BMad 方法 v5 - BMB（构建器）模块的一部分。

