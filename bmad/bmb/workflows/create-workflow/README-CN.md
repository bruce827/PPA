# 构建工作流

## 概述

构建工作流是一个交互式工作流构建器，指导您创建具有适当结构、约定和验证的新 BMAD 工作流。它确保所有工作流遵循最佳实践以实现最佳的人机协作，并完全符合 BMAD Core v6 工作流执行引擎的要求。

## 主要功能

- **可选头脑风暴阶段**：在结构化开发之前进行工作流创意探索
- **全面指导**：包含详细说明和示例的分步流程
- **基于模板**：为所有工作流组件使用经过验证的模板
- **约定强制执行**：确保遵守 BMAD 工作流创建指南
- **README 生成**：自动创建全面的文档
- **内置验证**：包含用于质量保证的检查清单生成
- **类型感知**：适应文档、操作、交互、自主或元工作流类型

## 使用方法

### 基本调用

```bash
workflow create-workflow
```

### 通过 BMad 构建代理

```bash
*create-workflow
```

### 您将被询问的内容

1. **可选**：是否先进行工作流创意头脑风暴（创意探索阶段）
2. 工作流名称和目标模块
3. 工作流目的和类型（如果使用了头脑风暴，则由其见解增强）
4. 元数据（描述、作者、输出）
5. 分步设计（目标、变量、流程）
6. 是否包含可选组件

## 工作流结构

### 包含的文件

```text
create-workflow/
├── workflow.yaml                  # 配置和元数据
├── instructions.md                # 分步执行指南
├── checklist.md                   # 验证标准
├── workflow-creation-guide.md     # 全面参考指南
├── README.md                      # 本文件
└── workflow-template/             # 新工作流的模板
    ├── workflow.yaml
    ├── instructions.md
    ├── template.md
    ├── checklist.md
    └── README.md
```

## 工作流过程

### 阶段 0：可选头脑风暴（步骤 -1）

- **创意探索**：在结构化开发之前选择头脑风暴工作流创意
- **设计概念开发**：生成多种方法并探索不同的可能性
- **需求澄清**：使用头脑风暴输出来确定工作流目的、类型和结构
- **增强创造力**：利用 AI 头脑风暴工具进行创新的工作流设计

头脑风暴阶段调用 CIS 头脑风暴工作流以：

- 探索工作流创意和方法
- 澄清需求和用例
- 为复杂的自动化需求生成创意解决方案
- 为结构化工作流构建过程提供信息

### 阶段 1：规划（步骤 0-3）

- 加载工作流创建指南和约定
- 定义工作流目的、名称和类型（如果使用了头脑风暴，则参考其结果）
- 收集元数据和配置详情
- 设计步骤结构和流程

### 阶段 2：生成（步骤 4-8）

- 创建具有适当配置的 workflow.yaml
- 生成具有 XML 结构步骤的 instructions.md
- 创建 template.md（用于文档工作流）
- 生成验证检查清单
- 创建支持数据文件（可选）

### 阶段 3：文档和验证（步骤 9-11）

- 创建全面的 README.md（必需）
- 测试和验证工作流结构
- 提供使用说明和后续步骤

## 输出

### 生成的工作流文件夹

在以下位置创建完整的工作流文件夹：

`{project-root}/bmad/{{target_module}}/workflows/{{workflow_name}}/`

### 创建的文件

#### 始终创建

- `workflow.yaml` - 包含路径和变量的配置
- `README.md` - 全面的文档（v6 版本后为必需）
- `instructions.md` - 执行步骤（如果不是仅模板的工作流）

#### 有条件创建

- `template.md` - 文档结构（用于文档工作流）
- `checklist.md` - 验证标准（可选但推荐）
- 支持数据文件（根据需要使用 CSV、JSON 等）

### 输出结构

对于文档工作流，README 记录：

- 工作流目的和用例
- 包含实际命令的使用示例
- 输入期望
- 输出结构和位置
- 最佳实践

## 要求

- 访问工作流创建指南
- BMAD Core v6 项目结构
- 用于托管新工作流的模块（bmm、bmb、cis 或自定义）

## 最佳实践

### 开始之前

1. **考虑头脑风暴**：如果您不确定工作流方法，请使用可选的头脑风暴阶段
2. 查看工作流创建指南以了解约定
3. 清楚了解工作流的目的（或准备好进行创意探索）
4. 知道您正在创建哪种类型的工作流（文档、操作等）或对发现持开放态度
5. 确定所需的任何数据文件或引用

### 创意工作流设计

create-workflow 现在支持**从创意构思到结构化实现的无缝过渡**：

- **"我需要一个工作流来做某事..."** → 从头脑风暴开始探索可能性
- **头脑风暴** → 生成多种方法并澄清需求
- **结构化工作流** → 使用头脑风暴的见解构建实际工作流
- **一个无缝会话** → 完成从创意到实现的整个过程

### 执行期间

1. 遵循 kebab-case 命名约定
2. 对步骤目标和说明要具体
3. 使用描述性变量名（snake_case）
4. 设置适当的限制（"最多 3-5 项"）
5. 在有帮助的地方包含示例

### 完成后

1. 测试新创建的工作流
2. 根据检查清单进行验证
3. 确保 README 全面且准确
4. 测试所有文件路径和变量引用

## 故障排除

### 问题：生成的工作流无法执行

- **解决方案**：验证 workflow.yaml 中的所有文件路径使用适当的变量替换
- **检查**：确保 installed_path 和 project-root 设置正确

### 问题：变量在模板中未替换

- **解决方案**：确保 instructions `<template-output>` 标签和 template `{{variables}}` 之间的变量名完全匹配
- **检查**：始终使用 snake_case

### 问题：README 包含占位符文本

- **解决方案**：此工作流现在强制执行 README 生成 - 确保步骤 10 完全完成
- **检查**：不应保留 {WORKFLOW_TITLE} 或类似的占位符

## 自定义

要修改此工作流：

1. 编辑 `instructions.md` 以调整创建过程
2. 更新 `workflow-template/` 中的模板以更改生成的文件
3. 修改 `workflow-creation-guide.md` 以更新约定
4. 编辑 `checklist.md` 以更改验证标准

## 版本历史

- **v6.0.0** - README.md 现在对所有工作流都是必需的
  - 添加了全面的 README 模板
  - 增强了文档验证
  - 改进了步骤 10，包含详细的 README 要求

- **v5.0.0** - 初始 BMAD Core v6 兼容版本
  - 基于模板的工作流生成
  - 约定强制执行
  - 验证检查清单支持

## 支持

如有问题或疑问：

- 查看 `/bmad/bmb/workflows/create-workflow/workflow-creation-guide.md`
- 查看 `/bmad/bmm/workflows/` 中的现有工作流作为示例
- 根据 `/bmad/bmb/workflows/create-workflow/checklist.md` 进行验证
- 查阅 BMAD 方法 v6 文档

---

此文档为 BMad 方法 v6 - BMB（BMad 构建器）模块的一部分。
