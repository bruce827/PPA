# 构建代理

## 概述

构建代理工作流是一个交互式代理构建器，可指导您创建符合 BMAD Core 的代理，将其作为 YAML 源文件编写，并在安装时编译为最终的 `.md` 文件。它支持三种代理类型：简单代理（Simple，自包含）、专家代理（Expert，带有附属资源）和模块代理（Module，具有完整功能和工作流）。

## 主要功能

- **可选头脑风暴**：在构建代理之前进行创意构思会话，探索概念和个性
- **三种代理类型**：简单代理、专家代理和模块代理，具有适当的结构
- **角色开发**：指导创建角色、身份、沟通风格和原则
- **命令构建器**：交互式命令定义，支持工作流/任务/操作模式
- **内置验证**：确保 YAML 结构和 BMAD Core 合规性
- **自定义支持**：可选的 `customize.yaml` 文件，用于角色/菜单覆盖和关键操作
- **附属资源**：为专家代理设置特定领域的数据

## 使用方法

### 基本调用

```bash
workflow create-agent
```

### 通过 BMad 构建代理

```
*create-agent
```

### 启用头脑风暴会话

工作流包括一个可选的头脑风暴阶段（步骤 -1），帮助您在构建之前探索代理的概念、个性和能力。这在您只有模糊想法并希望将其发展为具体代理概念时特别有用。

### 您将被询问的内容

0. **可选头脑风暴**（模糊想法 → 精炼概念）
1. 代理类型（简单、专家或模块）
2. 基本身份（名称、标题、图标、文件名）
3. 模块分配（针对模块代理）
4. 附属资源（针对专家代理）
5. 角色元素（角色、身份、风格、原则）
6. 命令及其实现
7. 关键操作（可选）
8. 激活规则（可选，极少需要）

## 工作流结构

### 包含的文件

```
create-agent/
├── workflow.yaml                  # 配置文件
├── instructions.md                # 分步指南
├── checklist.md                   # 验证标准
├── README.md                      # 本文件
├── agent-types.md                 # 代理类型文档
├── agent-architecture.md          # 架构模式
├── agent-command-patterns.md      # 命令模式参考
└── communication-styles.md        # 风格示例
```

## 工作流过程

### 阶段 0：可选头脑风暴（步骤 -1）

- 使用多种头脑风暴技术进行创意构思会话
- 探索代理概念、个性和能力
- 生成角色创意、专业领域和命令概念
- 输出直接用于代理身份和角色开发

### 阶段 1：代理设置（步骤 0-2）

- 加载代理构建文档和模式
- 选择代理类型（简单/专家/模块）
- 定义基本身份（名称、标题、图标、文件名）- 如果完成头脑风暴，则参考其结果
- 分配到模块（针对模块代理）

### 阶段 2：角色开发（步骤 2-3）

- 定义角色和职责 - 如果可用，利用头脑风暴见解
- 塑造独特的身份和背景故事
- 选择沟通风格 - 可使用头脑风暴的个性概念
- 确立指导原则
- 添加关键操作（可选）

### 阶段 3：命令构建（步骤 4）

- 添加 *help* 和 *exit* 命令（必需）
- 定义工作流命令（最常见）
- 添加任务命令（用于单一操作）
- 创建操作命令（内联逻辑）
- 配置命令属性

### 阶段 4：最终确定（步骤 5-10）

- 确认激活行为（大多自动）
- 生成 `.agent.yaml` 文件
- 可选：创建自定义文件以进行覆盖
- 设置附属资源（针对专家代理）
- 验证 YAML 并编译为 `.md`
- 提供使用说明

## 输出

### 生成的文件

#### 针对独立代理（不属于模块）

- **YAML 源文件**：`{custom_agent_location}/{{agent_filename}}.agent.yaml`（默认：`bmad/agents/`）
- **安装位置**：`{project-root}/bmad/agents/{{agent_filename}}.md`
- **编译**：运行 BMAD 方法安装程序并选择“编译代理（快速重建所有代理 .md 文件）”

#### 针对模块代理

- **YAML 源文件**：`src/modules/{{target_module}}/agents/{{agent_filename}}.agent.yaml`
- **安装位置**：`{project-root}/bmad/{{module}}/agents/{{agent_filename}}.md`
- **编译**：模块安装期间自动完成

### YAML 代理结构（简化版）

```yaml
agent:
  metadata:
    id: bmad/{{module}}/agents/{{agent_filename}}.md
    name: { { agent_name } }
    title: { { agent_title } }
    icon: { { agent_icon } }
    module: { { module } }
  persona:
    role: '...'
    identity: '...'
    communication_style: '...'
    principles: ['...', '...']
  menu:
    - trigger: example
      workflow: '{project-root}/path/to/workflow.yaml'
      description: Do the thing
```

### 可选自定义文件

如果创建，将生成于：
`{project-root}/bmad/_cfg/agents/{{module}}-{{agent_filename}}.customize.yaml`

## 安装与编译

### 代理安装位置

代理根据其类型安装到不同位置：

1. **独立代理**（不属于模块）
   - 源文件：创建于您的自定义代理位置（默认：`bmad/agents/`）
   - 安装到：`{project-root}/bmad/agents/`
   - 编译：运行 BMAD 方法安装程序并选择“编译代理”

2. **模块代理**（属于 BMM、BMB 或自定义模块）
   - 源文件：创建于 `src/modules/{module}/agents/`
   - 安装到：`{project-root}/bmad/{module}/agents/`
   - 编译：模块安装期间自动完成

### 编译过程

安装程序将 YAML 代理定义编译为 Markdown：

```bash
# 针对独立代理
npm run build:agents

# 针对所有 BMad 组件（包括代理）
npm run install:bmad

# 使用安装程序菜单
npm run installer
# 然后选择：编译代理
```

### 构建命令

用于代理管理的其他构建命令：

```bash
# 构建特定代理类型
npx bmad-method build:agents        # 构建独立代理
npx bmad-method build:modules        # 构建模块代理（带模块）

# 完全重建
npx bmad-method build:all           # 重建所有内容
```

## 要求

- BMAD Core v6 项目结构
- 用于托管代理的模块（针对模块代理）
- 理解代理的目的和命令
- 在命令中引用的工作流/任务（或标记为“待办”）

## 头脑风暴集成

可选的头脑风暴阶段（步骤 -1）提供了从模糊想法到具体代理概念的无缝路径：

### 何时使用头脑风暴

- **模糊概念**：例如“我想要一个帮助处理数据的代理”
- **创意探索**：希望发现独特的个性和方法
- **团队构建**：为具有特定角色的模块创建代理
- **角色开发**：需要完善代理的个性和语气

### 头脑风暴流程

1. **步骤 -1**：可选头脑风暴会话
   - 使用带有代理特定上下文的 CIS 头脑风暴工作流
   - 探索身份、个性、专业知识和命令概念
   - 生成详细的角色和能力创意

2. **步骤 0-2**：头脑风暴指导的代理设置
   - 头脑风暴输出指导代理类型选择
   - 角色概念影响基本身份选择
   - 个性见解塑造角色开发

3. **无缝过渡**：模糊想法 → 头脑风暴概念 → 构建代理

### 关键原则

用户可以在一个连续流程中从 **模糊想法 → 头脑风暴概念 → 构建代理**，头脑风暴输出直接用于代理开发。

## 最佳实践

### 开始之前

1. 查看 `/bmad/bmm/agents/` 中的示例代理以了解模式
2. 如果您有模糊概念需要开发，请考虑使用头脑风暴
3. 明确代理的角色和个性愿景（或使用头脑风暴开发）
4. 列出代理需要的命令/能力
5. 确定代理将调用的任何工作流或任务

### 执行期间

1. **代理名称**：使用反映个性的易记名称
2. **图标**：选择代表代理角色的表情符号
3. **角色**：使其独特并与沟通风格一致
4. **命令**：使用 kebab-case，自定义命令以字母开头（非 \*）
5. **工作流**：引用现有工作流或标记为“待办”以供后续实现

### 完成后

1. **编译代理**：
   - 针对独立代理：运行 `npm run build:agents` 或使用安装程序菜单
   - 针对模块代理：模块安装期间自动完成
2. **测试代理**：在您的 IDE 中使用已编译的 `.md` 代理
3. **实现占位符**：完成引用的任何“待办”工作流
4. **根据需要完善**：使用自定义文件调整角色
5. **随时间演进**：根据需求添加新命令

## 代理类型

### 简单代理

- **最佳用途**：自包含的实用工具、简单助手
- **特点**：嵌入式逻辑，无外部依赖
- **示例**：计算器代理、随机选择器、简单格式化器

### 专家代理

- **最佳用途**：具有数据/记忆的特定领域代理
- **特点**：附属文件夹、领域限制、记忆文件
- **示例**：日记记录器、项目日志、个人知识库

### 模块代理

- **最佳用途**：具有工作流的完整功能代理
- **特点**：模块的一部分，命令调用工作流
- **示例**：产品经理、架构师、研究助理

## 故障排除

### 问题：代理无法加载

- **解决方案**：验证 XML 结构是否正确
- **检查**：确保所有必需标签存在（角色、命令）

### 问题：命令无法工作

- **解决方案**：验证工作流路径是否正确或标记为“待办”
- **检查**：单独测试工作流调用

### 问题：角色感觉通用

- **解决方案**：查看沟通风格指南
- **检查**：使身份独特且特定于角色

## 自定义

要修改代理构建过程：

1. 编辑 `instructions.md` 以更改步骤
2. 更新 `agent-types.md` 以添加新代理模式
3. 修改 `agent-command-patterns.md` 以支持新命令类型
4. 编辑 `communication-styles.md` 以添加个性示例

## 版本历史

- **v6.0.0** - 兼容 BMAD Core v6
  - 三种代理类型（简单/专家/模块）
  - 增强的角色开发
  - 命令模式库
  - 验证框架

## 支持

如有问题或疑问：

- 查看 `/bmad/bmm/agents/` 中的示例代理
- 检查此工作流文件夹中的代理文档
- 先测试简单代理，然后逐步增加复杂性
- 查阅 BMAD 方法 v6 文档

---

此文档为 BMad 方法 v6 - BMB（BMad 构建模块）的一部分。